{% load static %}

<div class="row">
  <div class="col-12">
    <div class="content-header">Users</div>
  </div>
</div>

<!-- Wizard Starts -->
<section id="multiple-select2">
  <div class="row">
    <div class="col-xl-12 col-lg-12">
      <div class="card">
        <div class="card-header">
          <div class="float-right">
            <div class="row mb-1">

              <a hx-get="{% url 'user:create-user' %}" data-toggle="modal" data-target="#add_user" hx-swap="innerHTML" hx-target="#id-user-div" class="btn bg-light-primary mr-2"> <i class="fa ft-plus mr-2"></i> Add user </a>

            </div>
          </div>
        </div>
        <div class="card-body">
          <div class="card-content">
            <div claFVss="table-responsive">
              <table id="user-table" class="table table-striped table-bordered">
                <thead>
                  <tr>
                    <th>First Name</th>
                    <th>Last Name</th>
                    <th>Email</th>
                    <th>Actions</th>
                  </tr>
                </thead>
              </table>
            </div>
          </div>
        </div>
      </div>
    </div>

    <!-- Add User Modal -->
    <div class="modal fade text-left" id="add_user" tabindex="-1" role="dialog" aria-labelledby="myModalLabel33" aria-hidden="true" data-backdrop="false">
      <div class="modal-dialog modal-dialog-centered" role="document">
          <div class="modal-content" id="id-user-div">

          </div>
      </div>
    </div>


    <!-- Update User Modal Template -->
    <div class="modal fade text-left" id="update_user_modal" tabindex="-1" role="dialog" aria-labelledby="updateUserModalLabel" aria-hidden="true" data-backdrop="false">
      <div class="modal-dialog modal-dialog-centered" role="document">
          <div class="modal-content" id="update_user_modal_body">
                  <!-- User-specific content will be loaded here -->
              </div>
          </div>
      </div>
    </div>


  </div>
</section>

<!-- Htmx -->
<script>
document.body.addEventListener('htmx:beforeSwap', function(evt) {
  if(evt.detail.xhr.status === 200){
      if(evt.detail.requestConfig.verb != 'get')
      {
          evt.detail.shouldSwap = false;
          window.location.reload();
      }
  }
});
</script>
<!-- Htmx -->

<!-- Htmx -->
<script src="{% static 'app/js/jquery.min.js' %}"></script>
<script>
  $(document).on('click', '.htmx-trigger-btn' , function (e) {
    url = $(this).data("url")
    htmx.ajax('GET',
        url,
        {
          target:'#update_user_modal_body',
          swap:'innerHTML',
    }).then(() => {
        $('#update_user_modal').toggleClass('hidden');
    })
})
</script>
<!-- Htmx -->

<!-- User Data table Start -->
<script>

  targets = [-1, -2];
  table_id = "#user-table";
  url = "{% url 'user:ajax-user-list' %}";
  columns = [
      { data: 'first_name', name: 'first_name' },
      { data: 'last_name', name: 'last_name' },
      { data: 'email', name: 'email' },
      { data: 'action', name: 'action' }
  ];

</script>
<!-- User Data table End -->

<!-- Delete User ajax Start -->
<script>
	$(document).on('click', '.user-delete-btn', function (e) {
		var id = $(this).data("id")
		var user_name = $(this).data("title")
		if (user_name == "None") {
			user_name = ""
		}
		var url = $(this).data("url")
		var delete_ele = $(this)

		Swal.fire({
			html: `Are you sure you want to delete <b>${user_name}</b>?`,
			icon: 'question',
			showCloseButton: true,
			showCancelButton: true,
			confirmButtonColor: "#7442DB",

		}).then((result) => {

			/* Read more about isConfirmed, isDenied below */
			if (result.isConfirmed) {
				$.ajax({
					type: "POST",
					url: url,
					data: {
						"id": id,
						"csrfmiddlewaretoken": '{{ csrf_token }}'
					},
					success: function (data) {
						$("#user-table").DataTable().ajax.reload(null, false);

            if (data["code"] == "111"){
              window.location.reload();
            } else if (data["code"] == "200") {
              toastr.info(data.message, 'Deleted', {
                closeButton: true,
                progressBar: true,
                positionClass: 'toast-bottom-right',
                timeOut: 6000
              });
						}
					}
				});
			}else {
                Swal.fire("Cancel delete", "", "info");
            }
		})
	})
</script>
<!-- Delete User ajax End-->