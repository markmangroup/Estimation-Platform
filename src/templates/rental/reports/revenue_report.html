{% load static %}
<style>
    #tableContainer {
    display: none;
}
</style>
<!-- Date picker JS Strat-->
<script type="text/javascript" src="{% static 'datepicker/jquery.min.js' %}"></script>
<script type="text/javascript" src="{% static 'datepicker/moment.min.js' %}"></script>
<script type="text/javascript" src="{% static 'datepicker/daterangepicker.min.js' %}" defer></script>
<!-- Date picker JS End -->

<!-- Report Name Start -->
<h4 class="mt-4">Revenue Report</h4>
<!-- Report Name End -->

<!-- Main Start -->
<div class="card">
    <div class="card-body">
        <div class="row">
            <!-- Filters Start -->

            <!-- Items -->
            <div class="col">
                <label for="" class="form-label font-weight-bold">Equipment Marerial Group</label>
                <select class="select2 form-control" multiple>
                    <option value="All">ALL EXCEPT</option>
                    <option value="James Peter" data-number="107">Solid</option>
                    <option value="Emily Johnson" data-number="108">Soft</option>
                    <option value="Michael Brown" data-number="112">Hologram</option>
                </select>
            </div>

            <!-- Customer -->
            <div class="col">
                <label for="" class="form-label font-weight-bold"
                    >Customer</label
                >
                <select class="select2 form-control" multiple>
                    <option value="All">ALL EXCEPT</option>
                    <option value="James Peter">Emily Pair</option>
                    <option value="Emily Johnson">Brooke Marchy	</option>
                    <option value="Michael Brown">Paul Leimgruber</option>
                </select>
            </div>

            <!-- Warehouse -->
            <!-- <div class="col">
                <label for="" class="form-label font-weight-bold">Warehouse</label>
                <select class="select2 form-control" multiple>
                <option value="All">All</option>
                <option value="Bakersfield">Bakersfield</option>
                <option value="Brawley">Brawley</option>
                <option value="Colusa">Colusa</option>
                <option value="Corning">Corning</option>
                <option value="Delano">Delano</option>
                <option value="Hanford">Hanford</option>
                <option value="Hollister">Hollister</option>
                <option value="Lodi">Lodi</option>
                <option value="Old River">Old River</option>
                <option value="Yuma">Yuma</option>
                </select>
                
            </div> -->
            
            <!-- Date range -->
            <div class="col">
                <label for="" class="form-label font-weight-bold"
                >Revenue Period</label
                >
                <div class="reportrange form-control">
                <i class="fa fa-calendar"></i>&nbsp;
                <span></span> <i class="fa fa-caret-down"></i>
                </div>
            </div>

            <!-- Filters End -->    
        </div>
    </div>
</div>
<!-- Main End -->

<!-- Table Start -->
<div class="tab-pane" id="tab3" aria-labelledby="base-tab13">
    <div class="card">
        <div class="card-content">
        <div class="card-header">
            <!-- Buttons -->
            <div class="float-right mb-3">
                <div class="col-12 my-1">
                    <button
                    class="btn bg-light-info"
                    onclick="DownloadProductsInCSV('InTransit')"
                    >
                    <em class="ft-download"></em> Revenue CSV
                    </button>
                </div>
            </div>
            <!-- Buttons -->
        </div>
        <div class="card-body">
            <div id="InTransit" class="table-responsive">
            <table class="table table-striped table-bordered zero-configuration">
                <thead>
                    <tr>
                        <th class="text-center">Customer Name</th>
                        <th class="text-center">Order Number</th>
                        <th class="text-center">Equipment Parent Group</th>
                        <th class="text-center">Equipment ID</th> 
                        <th class="text-center">Equipment Name</th>
                        <th class="text-center">Quantity</th>
                        <th class="text-center">Price</th>
                        <th class="text-center">Revenue</th>
                        <th class="text-center">Rental Duration</th>
                        <th class="text-center">Account Manager</th>
                    </tr>
                </thead>
                <tbody>
                <!-- Row 1 -->
                <tr>
                    <td class="text-center">Paul Leimgruber</td>
                    <td class="text-center">O20240200018</td>
                    <td class="text-center">NSE0125</td>
                    <td class="text-center">1714</td>
                    <td class="text-center">10" Clamp</td>
                    <td class="text-right">10</td>
                    <td class="text-right">$2000.00</td>
                    <td class="text-right">$500.00</td>
                    <td class="text-center"> 5 Month</td>
                    <td class="text-center">Brawley Smith</td>
                    
                </tr>

                <!-- Row 2 -->
                <tr>
                    <td class="text-center">Brooke Marchy</td>
                    <td class="text-center">O20240200019</td>
                    <td class="text-center">NEE0129</td>
                    <td class="text-center">1715</td>
                    <td class="text-center">8" VIC Clamps</td>
                    <td class="text-right">10</td>
                    <td class="text-right">$2000.00</td>
                    <td class="text-right">$700.00</td>
                    <td class="text-center">10 Month</td>
                    <td class="text-center">Colusa John</td>
                </tr>

                <!-- Row 3 -->
                <tr>
                    <td class="text-center">Paul Leimgruber</td>
                    <td class="text-center">O20240200020</td>
                    <td class="text-center">NEE0300</td>
                    <td class="text-center">1720</td>
                    <td class="text-center">3" X 30' Yelomine Laterals</td>
                    <td class="text-right">16</td>
                    <td class="text-right">$2000.00</td>
                    <td class="text-right">$300.00</td>
                    <td class="text-center">4 Month</td>
                    <td class="text-center">Steven Roland</td>
                </tr>

                <!-- Row 4 -->
                <tr>
                    <td class="text-center">Brooke Marchy</td>
                    <td class="text-center">O20240200021</td>
                    <td class="text-center">NEE0222</td>
                    <td class="text-center">1720</td>
                    <td class="text-center">3" X 30' Yelomine Laterals</td>
                    <td class="text-right">5</td>
                    <td class="text-right">$1000.00</td>
                    <td class="text-right">$300.00</td>
                    <td class="text-center">6 Month</td>
                    <td class="text-center">Steven Roland</td>
                </tr>
            </table>
            <br>
            <div>
                <a id="showTableLink" data-toggle="modal" data-target="#showBreakdown" style="color:rgb(146, 100, 255); font-size: x-large;">Total Revenue : $6,000.00</a> 
            </div>
            </div>
        </div>
        </div>
    </div>
</div>
<!-- Table End -->

<!-- Modal -->
<div class="modal fade text-left" id="showBreakdown" tabindex="-1" role="dialog" aria-labelledby="myModalLabel16" aria-hidden="true" data-backdrop="false">
    <div class="modal-dialog modal-xl" role="document">
        <div class="modal-content">
            <div class="modal-header">
            <h4 class="modal-title" id="myModalLabel16">Revenue Breakdown</h4>
            <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                <span aria-hidden="true"><i class="ft-x font-medium-2 text-bold-700"></i></span>
            </button>
            </div>
            <br>
            <div class="container">
                <table class="table table-striped table-bordered zero-configuration">
                <thead>
                    <tr>
                        <th>Item Number</th>
                        <th>Items</th>
                        <th>Quantity</th>
                        <!-- <th>Date</th> -->
                        <!-- <th>Warehouse</th> -->
                        <!-- <th>Customer</th> -->
                        <th>Unit Price</th>
                        <th>Total Revenue</th>
                    </tr>
                </thead>
                <tbody>
                <!-- Row 1 -->
                <tr>
                    <td> 145 </td>
                    <td class="text-nowrap">3" X 30' Yelomine Laterals</td>
                    <td class="text-nowrap">10</td>
                    <!-- <td class="text-nowrap">01/04/2024</td> -->
                    <!-- <td class="text-nowrap">Bakersfield</td> -->
                    <!-- <td class="text-nowrap">Paul Leimgruber</td> -->
                    <td class="text-nowrap"> 120 </td>
                    <td>
                        <a data-toggle="modal">2000</a>
                    </td>
                    
                </tr>

                <!-- Row 2 -->
                <tr>
                    <td> 146 </td>
                    <td class="text-nowrap">8" VIC Clamps</td>
                    <td class="text-nowrap">10</td>
                    <!-- <td class="text-nowrap">01/04/2024</td> -->
                    <!-- <td class="text-nowrap">Delano</td> -->
                    <!-- <td class="text-nowrap">Paul Leimgruber</td> -->
                    <td class="text-nowrap"> 100 </td>
                    <td>
                        <a data-toggle="modal" >2000</a>
                    </td>
                    
                </tr>

                <!-- Row 3 -->
                <tr>
                    <td> 140 </td>
                    <td class="text-nowrap">Skid Booster Pump</td>
                    <td class="text-nowrap">10</td>
                    <!-- <td class="text-nowrap">01/05/2024</td> -->
                    <!-- <td class="text-nowrap">Lodi</td> -->
                    <!-- <td class="text-nowrap">Brooke Marchy</td> -->
                    <td class="text-nowrap"> 200 </td>
                    <td>
                        <a data-toggle="modal" data-target="#showBreakdown" >2000</a>
                    </td>
                    
                </tr>

                <!-- Row 4 -->
                <tr>
                    <td> 122 </td>
                    <td class="text-nowrap">10" Clamp</td>
                    <td class="text-nowrap">10</td>
                    <!-- <td class="text-nowrap">01/04/2024</td> -->
                    <!-- <td class="text-nowrap">Colusa</td> -->
                    <!-- <td class="text-nowrap">Brooke Marchy</td> -->
                    <td class="text-nowrap"> 250 </td>
                    <td>
                        <a data-toggle="modal" data-target="#showBreakdown">2000</a>
                    </td>
                    
                </tr>
                </table>
            </div>
            <div class="modal-footer">
            <button type="button" class="btn bg-light-secondary" data-dismiss="modal">Close</button>
            </div>
        </div>
    </div>
</div>





<div class="modal fade text-left" id="" tabindex="-1" role="modal" aria-labelledby="myModalLabel5" aria-hidden="true" data-backdrop="false">
    <div class="modal-dialog modal-md modal-dialog-centered" role="document">
        <div class="modal-content">
            <div class="modal-header">
                <h4 class="modal-title" id="myModalLabel5">Revenue Breakdown</h4>
                <button
                    type="button"
                    class="close"
                    data-dismiss="modal"
                    aria-label="Close"
                >
                    <span aria-hidden="true"
                    ><i class="ft-x font-medium-2 text-bold-700"></i
                    ></span>
                </button>
            
            </div>
            <div>
                <table class="table table-striped table-bordered zero-configuration">
                    <thead>
                        <tr>
                            <th>Item Number</th>
                            <th>Items</th>
                            <th>Quantity</th>
                            <th>Date</th>
                            <th>Warehouse</th>
                            <th>Customer</th>
                            <th>Unit Price</th>
                            <th>Total Revenue</th>
                        </tr>
                    </thead>
                    <tbody>
                    <!-- Row 1 -->
                    <tr>
                        <td> 145 </td>
                        <td class="text-nowrap">3" X 30' Yelomine Laterals</td>
                        <td class="text-nowrap">10</td>
                        <td class="text-nowrap">01/04/2024</td>
                        <td class="text-nowrap">Bakersfield</td>
                        <td class="text-nowrap">Paul Leimgruber</td>
                        <td class="text-nowrap"> 120 </td>
                        <td>
                            <a data-toggle="modal">2000</a>
                        </td>
                        
                    </tr>
    
                    <!-- Row 2 -->
                    <tr>
                        <td> 146 </td>
                        <td class="text-nowrap">8" VIC Clamps</td>
                        <td class="text-nowrap">10</td>
                        <td class="text-nowrap">01/04/2024</td>
                        <td class="text-nowrap">Delano</td>
                        <td class="text-nowrap">Paul Leimgruber</td>
                        <td class="text-nowrap"> 100 </td>
                        <td>
                            <a data-toggle="modal" >2000</a>
                        </td>
                        
                    </tr>
    
                    <!-- Row 3 -->
                    <tr>
                        <td> 140 </td>
                        <td class="text-nowrap">Skid Booster Pump</td>
                        <td class="text-nowrap">10</td>
                        <td class="text-nowrap">01/05/2024</td>
                        <td class="text-nowrap">Lodi</td>
                        <td class="text-nowrap">Brooke Marchy</td>
                        <td class="text-nowrap"> 200 </td>
                        <td>
                            <a data-toggle="modal" data-target="#showBreakdown" >2000</a>
                        </td>
                        
                    </tr>
    
                    <!-- Row 4 -->
                    <tr>
                        <td> 122 </td>
                        <td class="text-nowrap">10" Clamp</td>
                        <td class="text-nowrap">10</td>
                        <td class="text-nowrap">01/04/2024</td>
                        <td class="text-nowrap">Colusa</td>
                        <td class="text-nowrap">Brooke Marchy</td>
                        <td class="text-nowrap"> 250 </td>
                        <td>
                            <a data-toggle="modal" data-target="#showBreakdown">2000</a>
                        </td>
                        
                    </tr>
                </table>
            </div>
                Close
            </button>
            <button type="button" class="btn btn-primary" data-dismiss="modal">
                OK
            </button>
            </div>
        </div>
    </div>
</div>
<script src="{% static 'datepicker/jquery.min.js' %}"></script>
<script src="{% static 'vendors/js/select2.full.min.js' %}"></script>
<script src="{% static 'app/js/select2.min.js' %}"></script>


<!-- Search with number -->
<script>
    $(document).ready(function() {
        $('#SelectDescription').select2({
        width: '100%',
        matcher: function(params, data) {
            // If there are no search terms, return all options
            if ($.trim(params.term) === '') {
            return data;
            }

            // Convert the search term to uppercase for case-insensitive comparison
            var searchTerm = $.trim(params.term).toUpperCase();

            // Check if the option text or the data-number attribute contains the search term
            var textMatch = data.text.toUpperCase().indexOf(searchTerm) > -1;
            var numberMatch = $(data.element).data('number') !== undefined &&
                            $(data.element).data('number').toString().indexOf(searchTerm) > -1;

            // Return the data object if it matches either the text or the number
            if (textMatch || numberMatch) {
            return data;
            }

            // Return `null` if the term does not match
            return null;
        }
        });
    });
</script>
<!-- Search with number -->


<!-- Download CSV formate Script Start -->
<script>
    function DownloadProductsInCSV(id, fileName) {
        var table = document.getElementById(id);

        // Extract headers from the table
        var headers = [];
        var headerRow = table.querySelector("tr");
        var headerCols = headerRow.querySelectorAll("th, td");
        headerCols.forEach(function(col) {
        headers.push('"' + col.innerText.replace(/"/g, '""') + '"'); // Wrap headers in quotes and escape double quotes
        });
        var csvContent = headers.join(",") + "\n";

        // Add data rows to CSV content (start from the second row)
        var rows = table.querySelectorAll("tr");
        for (var i = 1; i < rows.length; i++) { // Start from index 1 to skip the header row
        var rowData = [];
        var cols = rows[i].querySelectorAll("td");
        cols.forEach(function(col) {
            rowData.push('"' + col.innerText.replace(/"/g, '""') + '"'); // Wrap cell data in quotes and escape double quotes
        });
        csvContent += rowData.join(",") + "\n";
        }

        // Create Blob object
        var blob = new Blob([csvContent], { type: "text/csv" });

        // Create temporary URL
        var url = window.URL.createObjectURL(blob);

        // Create a link element
        var link = document.createElement("a");
        link.setAttribute("href", url);
        link.setAttribute("download", fileName + ".csv");

        // Simulate a click on the link
        link.click();

        // Remove the temporary URL
        window.URL.revokeObjectURL(url);
    }
</script>
<!-- Download CSV formate Script End -->

<!-- Date picker Start -->
<script type="text/javascript">
    $(document).ready(function() {

    var start = moment().subtract(29, 'days');
    var end = moment();

    function cb(start, end) {
        $('.reportrange span').html(start.format('MMMM D, YYYY') + ' - ' + end.format('MMMM D, YYYY'));
    }

    $('.reportrange').daterangepicker({
        startDate: start,
        endDate: end,
        ranges: {
            'Today': [moment(), moment()],
            'Yesterday': [moment().subtract(1, 'days'), moment().subtract(1, 'days')],
            'Last 7 Days': [moment().subtract(6, 'days'), moment()],
            'Last 30 Days': [moment().subtract(29, 'days'), moment()],
            'This Month': [moment().startOf('month'), moment().endOf('month')],
            'Last Month': [moment().subtract(1, 'month').startOf('month'), moment().subtract(1, 'month').endOf('month')]
        }
    }, cb);

    cb(start, end);

    });
</script>
<!-- Date picker End -->

<!-- Select2 Script Start -->
<script>
    function customMatcher(params, data) {
        if ($.trim(params.term) === '') {
            return data;
        }

        const searchTerm = params.term.toLowerCase();

        if (data.text.toLowerCase().includes(searchTerm) || 
            (data.element && $(data.element).data('number') && $(data.element).data('number').toString().includes(searchTerm))) {
            return data;
        }

        return null;
    }

    $(".item-placeholder").select2({
        placeholder: "Search For Item Number or Item",
        allowClear: true,
        matcher: customMatcher
    });
</script>
<!-- Select2 Script End -->
<script>
    document.addEventListener('DOMContentLoaded', function() {
        var showTableLink = document.getElementById('showTableLink');
        var tableContainer = document.getElementById('tableContainer');
    
        // Initialize table visibility state
        var isTableVisible = false;
    
        showTableLink.addEventListener('click', function() {
            if (isTableVisible) {
                // Hide the table
                tableContainer.style.display = 'none';
            } else {
                // Show the table
                tableContainer.style.display = 'block';
            }
            // Toggle visibility state
            isTableVisible = !isTableVisible;
        });
    });
    </script>
    
    