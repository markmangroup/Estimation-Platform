{% load static %}
<!-- Date picker -->
<script type="text/javascript" src="{% static 'datepicker/jquery.min.js' %}"></script>
<script type="text/javascript" src="{% static 'datepicker/moment.min.js' %}"></script>
<script type="text/javascript" src="{% static 'datepicker/daterangepicker.min.js' %}" defer></script>
<!-- Date picker -->

<h4 class="mt-4">In Transit</h4>


  <div class="card">
    <div class="card-body">
    <div class="row">
      <!-- Filters Start -->

        <!-- Items -->
        <div class="col-4" style="margin-right: 20px;">
          <label for="" class="form-label font-weight-bold">From Location</label>
          <select class="select2 form-control" multiple>
              <option value="All">ALL EXCEPT</option>
              <option value="James Peter" data-number="107">8853 S Avenue 7 E, Yuma, AZ 85365</option>
              <option value="Emily Johnson" data-number="108">2920 Hwy 99 W, Corning, CA 96021</option>
              <option value="Michael Brown" data-number="112">9213 Old River Rd. Bakersfield, CA 93311</option>
              <option value="Michael Brown" data-number="112">3876 Allen Rd, Bakersfield, CA 93314	</option>
          </select>
        </div>

        <!-- Customer -->
        <div class="col-4">
          <label for="" class="form-label font-weight-bold"
              >To Location</label
          >
          <select class="select2 form-control" multiple>
            <option value="All">ALL EXCEPT</option>
            <option value="James Peter" data-number="107">8853 S Avenue 7 E, Yuma, AZ 85365</option>
            <option value="Emily Johnson" data-number="108">2920 Hwy 99 W, Corning, CA 96021</option>
            <option value="Michael Brown" data-number="112">9213 Old River Rd. Bakersfield, CA 93311</option>
            <option value="Michael Brown" data-number="112">3876 Allen Rd, Bakersfield, CA 93314	</option>
          </select>
        </div>

        <!-- Warehouse -->
        {% comment %} <div class="col">
          <label for="" class="form-label font-weight-bold">Warehouse</label>
          <select class="select2 form-control" multiple>
          <option value="All">All</option>
          <option value="Bakersfield">Bakersfield</option>
          <option value="Brawley">Brawley</option>
          <option value="Colusa">Colusa</option>
          <option value="Corning">Corning</option>
          <option value="Delano">Delano</option>
          <option value="Hanford">Hanford</option>
          <option value="Hollister">Hollister</option>
          <option value="Lodi">Lodi</option>
          <option value="Old River">Old River</option>
          <option value="Yuma">Yuma</option>
          </select>
          
        </div> {% endcomment %}
        
        <!-- Date range -->
        {% comment %} <div class="col">
          <label for="" class="form-label font-weight-bold"
            >Date</label
          >
          <div class=""> {% endcomment %}
            {% comment %} <i class="fa fa-calendar"></i>&nbsp; {% endcomment %}
            {% comment %} <input type="" class="form-control today-date"><span></span>
          </div>
        </div> {% endcomment %}

      <!-- Filters End -->    
    </div>
    </div>
  </div>
  
  <!-- Table Start -->
  <div class="tab-pane" id="tab3" aria-labelledby="base-tab13">
      <div class="card">
          <div class="card-content">
            <div class="card-header">
              <!-- Buttons -->
              <div class="float-right mb-3">
                <div class="col-12 my-1">
                  <button
                    class="btn bg-light-info"
                    onclick="DownloadProductsInCSV('InTransit')"
                  >
                    <em class="ft-download"></em> In Transit CSV
                  </button>
                </div>
              </div>
              <!-- Buttons -->
            </div>
          <div class="card-body">
              <div id="InTransit" class="table-responsive">
              <table class="table table-striped table-bordered zero-configuration">
                  <thead>
                  <tr>
                    <th class="text-center">Equipment ID</th>
                    <th class="text-center">Equipment Name</th>
                    <th class="text-center">Customer</th>
                    <th class="text-center">Order Number</th>
                    <th class="text-center">Delivery Number</th>
                    <th class="text-center">From Location</th>
                    <th class="text-center">To Location</th>
                    <th class="text-center">Dispatch Date</th>
                  </tr>
                  </thead>
                  <tbody>
                    <!-- Row 1 -->
                    <tr>
                        <td class="text-center"> 145 </td>
                        <td class="text-center">3" X 30' Yelomine Laterals</td>
                        <td class="text-center">Brooke Marchy	</td>
                        <td class="text-center">O202402000</td>
                        <td class="text-center">O202402000-1</td>
                        <td class="text-center">3876 Allen Rd, Bakersfield, CA 93314</td>
                        <td class="text-center">2959 Davison Ct, Colusa, CA 95932</td>
                        <td class="text-center">02/04/2024</td>
                    </tr>

                    <!-- Row 2 -->
                    <tr>
                      <td class="text-center"> 146 </td>
                      <td class="text-center">8" VIC Clamps</td>
                      <td class="text-center">Brooke Marchy	</td>
                      <td class="text-center">O2024020001</td>
                      <td class="text-center">O2024020001-2</td>
                      <td class="text-center">9213 Old River Rd. Bakersfield, CA 93311</td>
                      <td class="text-center">2241 OLD AIRLINE HWY, PAICINES, CA 95043</td>
                      <td class="text-center">22/04/2024</td>
                    </tr>

                    <!-- Row 3 -->
                    <tr>
                      <td class="text-center"> 140 </td>
                      <td class="text-center">Skid Booster Pump</td>
                      <td class="text-center">Paul Leimgruber</td>
                      <td class="text-center">O2024020002</td>
                      <td class="text-center">O2024020002-1</td>  
                      <td class="text-center">2920 Hwy 99 W, Corning, CA 96021</td>
                      <td class="text-center">325 Rd 192, Delano, CA 93215</td>
                      <td class="text-center">30/06/2024</td>
                    </tr>

                    <!-- Row 4 -->
                    <tr>
                      <td class="text-center"> 122 </td>
                      <td class="text-center">10" Clamp</td>
                      <td class="text-center">Paul Leimgruber</td>
                      <td class="text-center">O2024020003</td>
                      <td class="text-center">O2024020003-1</td>
                      <td class="text-center">8853 S Avenue 7 E, Yuma, AZ 85365</td>
                      <td class="text-center">3876 Allen Rd, Bakersfield, CA 93314</td>
                      <td class="text-center">03/05/2024</td>
                    </tr>
              </table>
              </div>
          </div>
          </div>
      </div>
  </div>
  <!-- Add table -->

<!-- Script Start -->
<script src="{% static 'vendors/js/select2.full.min.js' %}"></script>
<script src="{% static 'app/js/select2.min.js' %}"></script>
<!-- Script End -->

<!-- Download CSV formate Script Start -->
<script>
  function DownloadProductsInCSV(id, fileName) {
    var table = document.getElementById(id);

    // Extract headers from the table
    var headers = [];
    var headerRow = table.querySelector("tr");
    var headerCols = headerRow.querySelectorAll("th, td");
    headerCols.forEach(function(col) {
      headers.push('"' + col.innerText.replace(/"/g, '""') + '"'); // Wrap headers in quotes and escape double quotes
    });
    var csvContent = headers.join(",") + "\n";

    // Add data rows to CSV content (start from the second row)
    var rows = table.querySelectorAll("tr");
    for (var i = 1; i < rows.length; i++) { // Start from index 1 to skip the header row
      var rowData = [];
      var cols = rows[i].querySelectorAll("td");
      cols.forEach(function(col) {
        rowData.push('"' + col.innerText.replace(/"/g, '""') + '"'); // Wrap cell data in quotes and escape double quotes
      });
      csvContent += rowData.join(",") + "\n";
    }

    // Create Blob object
    var blob = new Blob([csvContent], { type: "text/csv" });

    // Create temporary URL
    var url = window.URL.createObjectURL(blob);

    // Create a link element
    var link = document.createElement("a");
    link.setAttribute("href", url);
    link.setAttribute("download", fileName + ".csv");

    // Simulate a click on the link
    link.click();

    // Remove the temporary URL
    window.URL.revokeObjectURL(url);
  }
</script>
<!-- Download CSV formate Script End -->
  
<!-- Date picker -->
<script type="text/javascript">
  $(document).ready(function() {
  
      var start = moment().subtract(29, 'days');
      var end = moment();
  
      function cb(start, end) {
          $('.reportrange span').html(start.format('MMMM D, YYYY') + ' - ' + end.format('MMMM D, YYYY'));
      }
  
      $('.reportrange').daterangepicker({
          startDate: start,
          endDate: end,
          ranges: {
            'Today': [moment(), moment()],
            'Yesterday': [moment().subtract(1, 'days'), moment().subtract(1, 'days')],
            'Last 7 Days': [moment().subtract(6, 'days'), moment()],
            'Last 30 Days': [moment().subtract(29, 'days'), moment()],
            'This Month': [moment().startOf('month'), moment().endOf('month')],
            'Last Month': [moment().subtract(1, 'month').startOf('month'), moment().subtract(1, 'month').endOf('month')]
          }
      }, cb);
  
      cb(start, end);
  
  });
</script>

<!-- JavaScript to change dropdown toggle text based on selection -->
<script>
  
  document.querySelectorAll('.dropdown-item').forEach(item => {
    item.addEventListener('click', function() {
      let reportName = this.textContent.trim();
      document.getElementById('selectReportsDropdown').textContent = reportName;
    });
  });
</script>

<!-- Select2 Script Start -->
<script>
  function customMatcher(params, data) {
      if ($.trim(params.term) === '') {
          return data;
      }

      const searchTerm = params.term.toLowerCase();

      if (data.text.toLowerCase().includes(searchTerm) || 
          (data.element && $(data.element).data('number') && $(data.element).data('number').toString().includes(searchTerm))) {
          return data;
      }

      return null;
  }

  $(".item-placeholder").select2({
      placeholder: "Search For Item Number or Item",
      allowClear: true,
      matcher: customMatcher
  });
</script>
<!-- Select2 Script End -->
<script>
  $(document).ready(function() {
      var today = new Date().toISOString().split('T')[0];
      $('.today-date').val(today);
  });
</script>