{% load static %}
<!-- Date picker JS Strat-->
<script type="text/javascript" src="{% static 'datepicker/jquery.min.js' %}"></script>
<script type="text/javascript" src="{% static 'datepicker/moment.min.js' %}"></script>
<script type="text/javascript" src="{% static 'datepicker/daterangepicker.min.js' %}" defer></script>
<!-- Date picker JS End -->

<!-- Report Name Start -->
<h4 class="mt-4">Revenue Report</h4>
<!-- Report Name End -->

<!-- Main Start -->
<div class="card">
    <div class="card-body">
        <div class="row">
            <!-- Filters Start -->

            <!-- Items -->
            <div class="col">
                <label for="" class="form-label font-weight-bold">Items</label>
                <select class="item-placeholder form-control" multiple>
                    <option value="James Peter" data-number="107">Skid Booster Pump</option>
                    <option value="Emily Johnson" data-number="108">8" VIC Clamps</option>
                    <option value="Michael Brown" data-number="112">10" Perforated Suction Basket</option>
                </select>
            </div>

            <!-- Customer -->
            <div class="col">
                <label for="" class="form-label font-weight-bold"
                    >Customer</label
                >
                <select class="select2 form-control" multiple>
                    <option value="All">All</option>
                    <option value="James Peter">Emily Pair</option>
                    <option value="Emily Johnson">Brooke Marchy	</option>
                    <option value="Michael Brown">Paul Leimgruber</option>
                </select>

            </div>

            <!-- Warehouse -->
            <div class="col">
                <label for="" class="form-label font-weight-bold">Warehouse</label>
                <select class="select2 form-control" multiple>
                <option value="All">All</option>
                <option value="Bakersfield">Bakersfield</option>
                <option value="Brawley">Brawley</option>
                <option value="Colusa">Colusa</option>
                <option value="Corning">Corning</option>
                <option value="Delano">Delano</option>
                <option value="Hanford">Hanford</option>
                <option value="Hollister">Hollister</option>
                <option value="Lodi">Lodi</option>
                <option value="Old River">Old River</option>
                <option value="Yuma">Yuma</option>
                </select>

            </div>

            <!-- Date range -->
            <div class="col">
                <label for="" class="form-label font-weight-bold"
                >Date</label
                >
                <div class="reportrange form-control">
                <i class="fa fa-calendar"></i>&nbsp;
                <span></span> <i class="fa fa-caret-down"></i>
                </div>
            </div>

            <!-- Filters End -->
        </div>
    </div>
</div>
<!-- Main End -->

<!-- Table Start -->
<div class="tab-pane" id="tab3" aria-labelledby="base-tab13">
    <div class="card">
        <div class="card-content">
        <div class="card-header">
            <!-- Buttons -->
            <div class="float-right mb-3">
                <div class="col-12 my-1">
                    <button
                    class="btn bg-light-info"
                    onclick="DownloadProductsInCSV('InTransit')"
                    >
                    <em class="ft-download"></em> Revenue CSV
                    </button>
                </div>
            </div>
            <!-- Buttons -->
        </div>
        <div class="card-body">
            <div id="InTransit" class="table-responsive">
            <table class="table table-striped table-bordered zero-configuration">
                <thead>
                    <tr>
                        <th>Item Number</th>
                        <th>Items</th>
                        <th>Quantity</th>
                        <th>Date</th>
                        <th>Warehouse</th>
                        <th>Customer</th>
                        <th>Unit Price</th>
                        <th>Total Revenue</th>
                    </tr>
                </thead>
                <tbody>
                <!-- Row 1 -->
                <tr>
                    <td> 145 </td>
                    <td class="text-nowrap">3" X 30' Yelomine Laterals</td>
                    <td class="text-nowrap">10</td>
                    <td class="text-nowrap">01/04/2024</td>
                    <td class="text-nowrap">Bakersfield</td>
                    <td class="text-nowrap">Paul Leimgruber</td>
                    <td class="text-nowrap"> 120 </td>
                    <td class="text-nowrap"> 1000 </td>

                </tr>

                <!-- Row 2 -->
                <tr>
                    <td> 146 </td>
                    <td class="text-nowrap">8" VIC Clamps</td>
                    <td class="text-nowrap">10</td>
                    <td class="text-nowrap">01/04/2024</td>
                    <td class="text-nowrap">Delano</td>
                    <td class="text-nowrap">Paul Leimgruber</td>
                    <td class="text-nowrap"> 100 </td>
                    <td class="text-nowrap"> 1000 </td>

                </tr>

                <!-- Row 3 -->
                <tr>
                    <td> 140 </td>
                    <td class="text-nowrap">Skid Booster Pump</td>
                    <td class="text-nowrap">10</td>
                    <td class="text-nowrap">01/05/2024</td>
                    <td class="text-nowrap">Lodi</td>
                    <td class="text-nowrap">Brooke Marchy</td>
                    <td class="text-nowrap"> 200 </td>
                    <td class="text-nowrap"> 1000 </td>

                </tr>

                <!-- Row 4 -->
                <tr>
                    <td> 122 </td>
                    <td class="text-nowrap">10" Clamp</td>
                    <td class="text-nowrap">10</td>
                    <td class="text-nowrap">01/04/2024</td>
                    <td class="text-nowrap">Colusa</td>
                    <td class="text-nowrap">Brooke Marchy</td>
                    <td class="text-nowrap"> 250 </td>
                    <td class="text-nowrap"> 1000 </td>

                </tr>
            </table>
            </div>
        </div>
        </div>
    </div>
</div>
<!-- Table End -->


<script src="{% static 'datepicker/jquery.min.js' %}"></script>
<script src="{% static 'vendors/js/select2.full.min.js' %}"></script>
<script src="{% static 'app/js/select2.min.js' %}"></script>


<!-- Search with number -->
<script>
    $(document).ready(function() {
        $('#SelectDescription').select2({
        width: '100%',
        matcher: function(params, data) {
            // If there are no search terms, return all options
            if ($.trim(params.term) === '') {
            return data;
            }

            // Convert the search term to uppercase for case-insensitive comparison
            var searchTerm = $.trim(params.term).toUpperCase();

            // Check if the option text or the data-number attribute contains the search term
            var textMatch = data.text.toUpperCase().indexOf(searchTerm) > -1;
            var numberMatch = $(data.element).data('number') !== undefined &&
                            $(data.element).data('number').toString().indexOf(searchTerm) > -1;

            // Return the data object if it matches either the text or the number
            if (textMatch || numberMatch) {
            return data;
            }

            // Return `null` if the term does not match
            return null;
        }
        });
    });
</script>
<!-- Search with number -->


<!-- Download CSV formate Script Start -->
<script>
    function DownloadProductsInCSV(id, fileName) {
        var table = document.getElementById(id);

        // Extract headers from the table
        var headers = [];
        var headerRow = table.querySelector("tr");
        var headerCols = headerRow.querySelectorAll("th, td");
        headerCols.forEach(function(col) {
        headers.push('"' + col.innerText.replace(/"/g, '""') + '"'); // Wrap headers in quotes and escape double quotes
        });
        var csvContent = headers.join(",") + "\n";

        // Add data rows to CSV content (start from the second row)
        var rows = table.querySelectorAll("tr");
        for (var i = 1; i < rows.length; i++) { // Start from index 1 to skip the header row
        var rowData = [];
        var cols = rows[i].querySelectorAll("td");
        cols.forEach(function(col) {
            rowData.push('"' + col.innerText.replace(/"/g, '""') + '"'); // Wrap cell data in quotes and escape double quotes
        });
        csvContent += rowData.join(",") + "\n";
        }

        // Create Blob object
        var blob = new Blob([csvContent], { type: "text/csv" });

        // Create temporary URL
        var url = window.URL.createObjectURL(blob);

        // Create a link element
        var link = document.createElement("a");
        link.setAttribute("href", url);
        link.setAttribute("download", fileName + ".csv");

        // Simulate a click on the link
        link.click();

        // Remove the temporary URL
        window.URL.revokeObjectURL(url);
    }
</script>
<!-- Download CSV formate Script End -->

<!-- Date picker Start -->
<script type="text/javascript">
    $(document).ready(function() {

    var start = moment().subtract(29, 'days');
    var end = moment();

    function cb(start, end) {
        $('.reportrange span').html(start.format('MMMM D, YYYY') + ' - ' + end.format('MMMM D, YYYY'));
    }

    $('.reportrange').daterangepicker({
        startDate: start,
        endDate: end,
        ranges: {
            'Today': [moment(), moment()],
            'Yesterday': [moment().subtract(1, 'days'), moment().subtract(1, 'days')],
            'Last 7 Days': [moment().subtract(6, 'days'), moment()],
            'Last 30 Days': [moment().subtract(29, 'days'), moment()],
            'This Month': [moment().startOf('month'), moment().endOf('month')],
            'Last Month': [moment().subtract(1, 'month').startOf('month'), moment().subtract(1, 'month').endOf('month')]
        }
    }, cb);

    cb(start, end);

    });
</script>
<!-- Date picker End -->

<!-- Select2 Script Start -->
<script>
    function customMatcher(params, data) {
        if ($.trim(params.term) === '') {
            return data;
        }

        const searchTerm = params.term.toLowerCase();

        if (data.text.toLowerCase().includes(searchTerm) ||
            (data.element && $(data.element).data('number') && $(data.element).data('number').toString().includes(searchTerm))) {
            return data;
        }

        return null;
    }

    $(".item-placeholder").select2({
        placeholder: "Search For Item Number or Item",
        allowClear: true,
        matcher: customMatcher
    });
</script>
<!-- Select2 Script End -->