{% load static %}

<div class="form-group">
  <!-- Mismatched Products starts -->
  <div class="row">
    <div id="MismatchedProducts" class="table-responsive">
      <table class="table table-striped table-bordered">
        <thead>
          <tr>
            <th>Material Description</th>
            <th>Cost</th>
            <th>Quoted Price</th>
            <th>Vendor Name</th>
          </tr>
        </thead>
        <tbody>
          <!-- Row 1 -->
          <tr>
            <td class="text-nowrap">Cement -711 Heavy Gray, Gallon</td>
            <td>$10.00</td>
            <td>$9.00</td>
            <td>Heriberto Herrera</td>
          </tr>
          <!-- Row 2 -->
          <tr>
            <td class="text-nowrap">Cement - Primer Purple P70 Gal</td>
            <td>$8.00</td>
            <td>$7.00</td>
            <td>Southwest Valve & Equipment, LLC</td>
          </tr>
          <!-- Row 3 -->
          <tr>
            <td class="text-nowrap">SURVEY FLAGS GLO ORA 21" WIRE</td>
            <td>$6.00</td>
            <td>$5.00</td>
            <td>Mario A. Jaques</td>
          </tr>
          <!-- Row 4 -->
          <tr>
            <td class="text-nowrap">Cement -719 Extra Heavy Gray, Quart</td>
            <td>$7.00</td>
            <td>$6.00</td>
            <td>Stoney Creek Production Inc.</td>
          </tr>
          <!-- Row 5 -->
          <tr>
            <td class="text-nowrap">PERMA-LOC COUPLING 062</td>
            <td>$10.00</td>
            <td>$9.00</td>
            <td>Geyserville - Geyserville Inn</td>
          </tr>
        </tbody>
      </table>
    </div>
  </div>
  <!-- Mismatched Products end -->

  <!-- Netsuite Compatible Products starts -->
  <div class="row">
    <div id="NetSuiteProducts" class="table-responsive">
      <table class="table table-striped table-bordered">
        <thead>
          <tr>
            <th>InternalID</th>
            <th>Task</th>
            <th>Quantity</th>
            <th>Description</th>
            <th>PartNumber</th>
          </tr>
        </thead>
        <tbody>
          <!-- Row 1 -->
          <tr>
            <td>1365826</td>
            <td>DR-001</td>
            <td>3</td>
            <td>TEE S40 2"</td>
            <td>401020</td>
          </tr>
          <!-- Row 2 -->
          <tr>
            <td>1365826</td>
            <td>DR-001</td>
            <td>3</td>
            <td>ELBOW S40 2" X 90</td>
            <td>540128</td>
          </tr>

          <!-- Row 3 -->
          <tr>
            <td>1365826</td>
            <td>DR-001</td>
            <td>3</td>
            <td>CAP S40 2"</td>
            <td>709083</td>
          </tr>

          <!-- Row 4 -->
          <tr>
            <td>1365826</td>
            <td>DR-001</td>
            <td>3</td>
            <td>EMPTY QT CAN 1.75" NECK</td>
            <td>362100</td>
          </tr>

          <!-- Row 5 -->
          <tr>
            <td>1365826</td>
            <td>DR-001</td>
            <td>3</td>
            <td>EMPTY PT CAN 1.75" NECK</td>
            <td>187543</td>
          </tr>

          <!-- Row 6 -->
          <tr>
            <td>1365826</td>
            <td>DR-001</td>
            <td>3</td>
            <td>FIGURE 8 062</td>
            <td>201457</td>
          </tr>

          <!-- Row 7 -->
          <tr>
            <td>1365826</td>
            <td>DR-001</td>
            <td>3</td>
            <td>DAUBER PINT CAN</td>
            <td>769201</td>
          </tr>

          <!-- Row 8 -->
          <tr>
            <td>1365826</td>
            <td>DR-001</td>
            <td>3</td>
            <td>Vacuum Pump - Industrial Grade</td>
            <td>VP-43890</td>
          </tr>

          <!-- Row 9 -->
          <tr>
            <td>1365826</td>
            <td>DR-001</td>
            <td>3</td>
            <td>PIPE PVC IPS S40 2" SW</td>
            <td>972635</td>
          </tr>

          <!-- Row 10 -->
          <tr>
            <td>1365826</td>
            <td>DR-001</td>
            <td>3</td>
            <td>PIPE PVC IPS CL125 2" SW</td>
            <td>605714</td>
          </tr>
        </tbody>
      </table>
    </div>
  </div>
  <!-- Netsuite Compatible Products end -->

  <!-- Quoted Price Products starts -->
  <div class="row">
    <div id="QuotedPriceProducts" class="table-responsive">
      <table class="table table-striped table-bordered">
        <thead class="text-center">
          <tr>
            <th>Item Code</th>
            <th>Standard Cost</th>
            <th>Quoted Cost</th>
            <th>Vendor Name</th
          </tr>
        </thead>
        <tbody>
          <!-- Row 1 -->
          <tr>
            <td>2800-117500</td>
            <td>54.124</td>
            <td>48.915</td>
            <td>Fenner Valley Farms LLC</td>
          </tr>

          <!-- Row 2 -->
          <tr>
            <td>2800-117501</td>
            <td>70.215</td>
            <td>63.193</td>
            <td>Jefre Bugni</td>
          </tr>

          <!-- Row 3 -->
          <tr>
            <td>2800-117502</td>
            <td>40.85</td>
            <td>36.765</td>
            <td>Yolo-Solano Air Quality Management District</td>
          </tr>

          <!-- Row 4 -->
          <tr>
            <td>2800-117503</td>
            <td>20.55</td>
            <td>18.495</td>
            <td>Machado Backhoe, Inc.</td>
          </tr>

          <!-- Row 5 -->
          <tr>
            <td>2800-117504</td>
            <td>12.245</td>
            <td>11.021</td>
            <td>Wonderful Laboratories LLC</td>
          </tr>

          <!-- Row 6 -->
          <tr>
            <td>2800-117505</td>
            <td>84.35</td>
            <td>75.915</td>
            <td>Salvador Gomez</td>
          </tr>
        </tbody>
      </table>
    </div>
  </div>
  <!-- Quoted Price Products end -->

  <div class="row">
    <div class="col-12 my-1">
      <button class="btn bg-light-primary" onclick="printContent('proposal')">
        <em class="ft-printer"></em> Proposal
      </button>
    </div>
    <div class="col-12 my-1">
      <button
        class="btn bg-light-info"
        onclick="DownloadProductsInCSV('MismatchedProducts')"
      >
        <em class="ft-download"></em> New Material Master Data
      </button>
    </div>

    <div class="col-12 my-1">
      <button
        class="btn bg-light-secondary"
        onclick="DownloadProductsInCSV('QuotedPriceProducts')"
      >
        <em class="ft-download"></em>Costs Variances
      </button>
    </div>
    <div class="col-12 my-1">
      <button
        class="btn bg-light-success"
        onclick="DownloadProductsInCSV('NetSuiteProducts')"
      >
        <em class="ft-download"></em>Netsuite Extract
      </button>
    </div>
  </div>

  <!-- Download CSV File -->
  {% comment %} <script>
    function DownloadProductsInCSV(id, fileName) {
      var table = document.getElementById(id);

      // Extract headers from the table
      var headers = [];
      var headerRow = table.querySelector("tr");
      var headerCols = headerRow.querySelectorAll("th, td");
      headerCols.forEach(function (col) {
        headers.push(col.innerText.trim());
      });
      var csvContent = headers.join(",") + "\n";

      // Add data rows to CSV content
      var rows = table.querySelectorAll("tr");
      rows.forEach(function (row) {
        var rowData = [];
        var cols = row.querySelectorAll("td");
        cols.forEach(function (col) {
          rowData.push('"' + col.innerText.replace(/"/g, '""') + '"');
        });
        csvContent += rowData.join(",") + "\n";
      });

      // Create Blob object
      var blob = new Blob([csvContent], { type: "text/csv" });

      // Create temporary URL
      var url = window.URL.createObjectURL(blob);

      // Create a link element
      var link = document.createElement("a");
      link.setAttribute("href", url);
      link.setAttribute("download", fileName + ".csv");

      // Simulate a click on the link
      link.click();

      // Remove the temporary URL
      window.URL.revokeObjectURL(url);
    }
  </script> {% endcomment %}
  <script>
    function DownloadProductsInCSV(id, fileName) {
      var table = document.getElementById(id);
  
      // Extract headers from the table
      var headers = [];
      var headerRow = table.querySelector("tr");
      var headerCols = headerRow.querySelectorAll("th, td");
      headerCols.forEach(function(col) {
        headers.push('"' + col.innerText.replace(/"/g, '""') + '"'); // Wrap headers in quotes and escape double quotes
      });
      var csvContent = headers.join(",") + "\n";
  
      // Add data rows to CSV content (start from the second row)
      var rows = table.querySelectorAll("tr");
      for (var i = 1; i < rows.length; i++) { // Start from index 1 to skip the header row
        var rowData = [];
        var cols = rows[i].querySelectorAll("td");
        cols.forEach(function(col) {
          rowData.push('"' + col.innerText.replace(/"/g, '""') + '"'); // Wrap cell data in quotes and escape double quotes
        });
        csvContent += rowData.join(",") + "\n";
      }
  
      // Create Blob object
      var blob = new Blob([csvContent], { type: "text/csv" });
  
      // Create temporary URL
      var url = window.URL.createObjectURL(blob);
  
      // Create a link element
      var link = document.createElement("a");
      link.setAttribute("href", url);
      link.setAttribute("download", fileName + ".csv");
  
      // Simulate a click on the link
      link.click();
  
      // Remove the temporary URL
      window.URL.revokeObjectURL(url);
    }
  </script>
  
  <!-- Download Quoted Price Products CSV File -->
  {% comment %} <script>
    function DownloadQuotedPriceProductsInCSV(id, fileName) {
      var table = document.getElementById(id);

      // Extract headers from the table
      var headers = [];
      var headerRows = table.querySelectorAll("thead tr");
      headerRows.forEach(function (row) {
        var headerCols = row.querySelectorAll("th, td");
        var rowData = [];
        headerCols.forEach(function (col) {
          // Check if the cell has colspan
          var colspan = parseInt(col.getAttribute("colspan")) || 1;
          var cellText = col.innerText.trim();
          for (var i = 0; i < colspan; i++) {
            rowData.push('"' + cellText.replace(/"/g, '""') + '"');
          }
        });
        headers.push(rowData.join(","));
      });
      var csvContent = headers.join("\n");

      // Add data rows to CSV content
      var rows = table.querySelectorAll("tbody tr");
      rows.forEach(function (row) {
        var rowData = [];
        var cols = row.querySelectorAll("td");
        cols.forEach(function (col) {
          rowData.push('"' + col.innerText.replace(/"/g, '""') + '"');
        });
        csvContent += "\n" + rowData.join(",");
      });

      // Create Blob object
      var blob = new Blob([csvContent], { type: "text/csv" });

      // Create temporary URL
      var url = window.URL.createObjectURL(blob);

      // Create a link element
      var link = document.createElement("a");
      link.setAttribute("href", url);
      link.setAttribute("download", fileName + ".csv");

      // Simulate a click on the link
      link.click();

      // Remove the temporary URL
      window.URL.revokeObjectURL(url);
    }
  </script> {% endcomment %}

  <!-- printContent function -->
  <script>
    // function to print the proposal based on provided ID attribute of tag
    function printContent(id) {
      var content = document.getElementById(id).innerHTML;
      var originalDocument = document.body.innerHTML;
      document.body.innerHTML = content;
      window.print();
      document.body.innerHTML = originalDocument;
    }
  </script>
</div>
