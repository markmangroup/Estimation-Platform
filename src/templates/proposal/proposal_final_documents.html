{% load static %}

<div class="form-group">
  <!-- Mismatched Products starts -->
  <div class="row">
    <div id="MismatchedProducts" class="table-responsive">
      <table class="table table-striped table-bordered">
        <thead>
          <tr>
            <th>Material Description</th>
            <th>Cost</th>
            <th>Vendor Quoted Cost</th>
            <th>Vendor Name</th>
          </tr>
        </thead>
        <tbody>
          <!-- Row 1 -->
          <tr>
            <td class="text-nowrap">Cement -711 Heavy Gray, Gallon</td>
            <td>$10.00</td>
            <td>$9.00</td>
            <td>Heriberto Herrera</td>
          </tr>
          <!-- Row 2 -->
          <tr>
            <td class="text-nowrap">Cement - Primer Purple P70 Gal</td>
            <td>$8.00</td>
            <td>$7.00</td>
            <td>Southwest Valve & Equipment, LLC</td>
          </tr>
          <!-- Row 3 -->
          <tr>
            <td class="text-nowrap">SURVEY FLAGS GLO ORA 21" WIRE</td>
            <td>$6.00</td>
            <td>$5.00</td>
            <td>Mario A. Jaques</td>
          </tr>
          <!-- Row 4 -->
          <tr>
            <td class="text-nowrap">Cement -719 Extra Heavy Gray, Quart</td>
            <td>$7.00</td>
            <td>$6.00</td>
            <td>Stoney Creek Production Inc.</td>
          </tr>
          <!-- Row 5 -->
          <tr>
            <td class="text-nowrap">PERMA-LOC COUPLING 062</td>
            <td>$10.00</td>
            <td>$9.00</td>
            <td>Geyserville - Geyserville Inn</td>
          </tr>

          <!-- Missmatched Lop -->
          <!--{% for n in new_material_master_data %}
              <tr>
                <td>{{ n.description }}</td>

                {% if n.standard_cost %}
                  <td>${{ n.standard_cost }}</td>
                {% elif n.local_cost %}
                  <td>${{ n.local_cost }}</td>
                {% else %}
                  <td> - </td>
                {% endif %}

                {% if n.vendor_quoted_cost %}
                  <td>${{ n.vendor_quoted_cost }}</td>
                {% else %}
                  <td> - </td>
                {% endif %}

                {% if n.vendor %}
                  <td>{{ n.vendor }}</td>
                {% else %}
                  <td> - </td>
                {% endif %}

              </tr>
          {% endfor %} -->
        </tbody>
      </table>
    </div>
  </div>

  <!-- Netsuite Compatible Products starts -->
  <div class="row">
    <div id="NetSuiteProducts" class="table-responsive">
      <table class="table table-striped table-bordered">
        <thead>
          <tr>
            <th>InternalID</th>
            <th>Task</th>
            <th>Quantity</th>
            <th>Description</th>
            <th>PartNumber</th>
          </tr>
        </thead>
        <tbody>
          <!-- Row 1 -->
          <tr>
            <td>1365826</td>
            <td>DR-001</td>
            <td>3</td>
            <td>TEE S40 2"</td>
            <td>401020</td>
          </tr>
          <!-- Row 2 -->
          <tr>
            <td>1365826</td>
            <td>DR-001</td>
            <td>3</td>
            <td>ELBOW S40 2" X 90</td>
            <td>540128</td>
          </tr>

          <!-- Row 3 -->
          <tr>
            <td>1365826</td>
            <td>DR-001</td>
            <td>3</td>
            <td>CAP S40 2"</td>
            <td>709083</td>
          </tr>

          <!-- Row 4 -->
          <tr>
            <td>1365826</td>
            <td>DR-001</td>
            <td>3</td>
            <td>EMPTY QT CAN 1.75" NECK</td>
            <td>362100</td>
          </tr>

          <!-- Row 5 -->
          <tr>
            <td>1365826</td>
            <td>DR-001</td>
            <td>3</td>
            <td>EMPTY PT CAN 1.75" NECK</td>
            <td>187543</td>
          </tr>

          <!-- Row 6 -->
          <tr>
            <td>1365826</td>
            <td>DR-001</td>
            <td>3</td>
            <td>FIGURE 8 062</td>
            <td>201457</td>
          </tr>

          <!-- Row 7 -->
          <tr>
            <td>1365826</td>
            <td>DR-001</td>
            <td>3</td>
            <td>DAUBER PINT CAN</td>
            <td>769201</td>
          </tr>

          <!-- Row 8 -->
          <tr>
            <td>1365826</td>
            <td>DR-001</td>
            <td>3</td>
            <td>Vacuum Pump - Industrial Grade</td>
            <td>VP-43890</td>
          </tr>

          <!-- Row 9 -->
          <tr>
            <td>1365826</td>
            <td>DR-001</td>
            <td>3</td>
            <td>PIPE PVC IPS S40 2" SW</td>
            <td>972635</td>
          </tr>

          <!-- Row 10 -->
          <tr>
            <td>1365826</td>
            <td>DR-001</td>
            <td>3</td>
            <td>PIPE PVC IPS CL125 2" SW</td>
            <td>605714</td>
          </tr>

          <!-- Netsuite lop -->
          <!-- {% for netsuite_data in netsuite_extract_data  %}
            <tr>
              {% if netsuite_data.task_mapping.task.internal_id %}
              <td>{{ netsuite_data.task_mapping.task.internal_id }}</td>
              {% else %}
              <td> - </td>
              {% endif %}
              <td>{{ netsuite_data.task_mapping.code }}</td>
              <td>{{ netsuite_data.quantity }}</td>
              <td>{{ netsuite_data.description }}</td>
              {% if  netsuite_data.item_code %}
                <td>{{ netsuite_data.item_code }}</td>
              {% else %}
                <td> - </td>
              {% endif %}
            </tr>
          {% endfor %} -->
        </tbody>
      </table>
    </div>
  </div>

  <!-- Quoted Price Products starts -->
  <div class="row">
    <div id="QuotedPriceProducts" class="table-responsive">
      <table class="table table-striped table-bordered">
        <thead class="text-center">
          <tr>
            <th>Item Code</th>
            <th>Standard Cost</th>
            <th>Vendor Quoted Cost</th>
            <th>Vendor Name</th>
          </tr>
        </thead>
        <tbody>
          
          <!-- Row 1 -->
          <tr>
            <td>2800-117500</td>
            <td>54.124</td>
            <td>48.915</td>
            <td>Fenner Valley Farms LLC</td>
          </tr>

          <!-- Row 2 -->
          <tr>
            <td>2800-117501</td>
            <td>70.215</td>
            <td>63.193</td>
            <td>Jefre Bugni</td>
          </tr>

          <!-- Row 3 -->
          <tr>
            <td>2800-117502</td>
            <td>40.85</td>
            <td>36.765</td>
            <td>Yolo-Solano Air Quality Management District</td>
          </tr>

          <!-- Row 4 -->
          <tr>
            <td>2800-117503</td>
            <td>20.55</td>
            <td>18.495</td>
            <td>Machado Backhoe, Inc.</td>
          </tr>

          <!-- Row 5 -->
          <tr>
            <td>2800-117504</td>
            <td>12.245</td>
            <td>11.021</td>
            <td>Wonderful Laboratories LLC</td>
          </tr>

          <!-- Row 6 -->
          <tr>
            <td>2800-117505</td>
            <td>84.35</td>
            <td>75.915</td>
            <td>Salvador Gomez</td>
          </tr>

          <!-- Quoted lop -->
          <!-- {% for q in cost_variances_data %}
            <tr>
              <td>{{ q.item_code }}</td>
              <td>${{ q.standard_cost }}</td>
              {% if q.vendor_quoted_cost %}
                <td>${{ q.vendor_quoted_cost }}</td>
              {% else %}
                <td> - </td>
              {% endif %}
              {% if q.vendor %}
                <td>{{ q.vendor }}</td>
              {% else %}
                <td> - </td>
              {% endif %}
            </tr>
          {% endfor %} -->
        </tbody>
      </table>
    </div>
  </div>

  <!-- Buttons -->
  <div class="row">
    <div class="col-12 my-1">
      <button type="button" class="btn bg-light-primary" onclick="printContent('proposal')">
        <em class="ft-printer"></em> Proposal
      </button>
    </div>
    <div class="col-12 my-1">
      <button
        type="button"
        class="btn bg-light-info"
        onclick="DownloadProductsInCSV('MismatchedProducts', 'new_material_master_data')"
      >
        <em class="ft-download"></em> New Material Master Data
      </button>
    </div>

    <div class="col-12 my-1">
      <button
        type="button"
        class="btn bg-light-secondary"
        onclick="DownloadProductsInCSV('QuotedPriceProducts', 'costs_variances')"
      >
        <em class="ft-download"></em>Costs Variances
      </button>
    </div>
    <div class="col-12 my-1">
      <button
        type="button"
        class="btn bg-light-success"
        onclick="DownloadProductsInCSV('NetSuiteProducts', 'netsuite_extract')"
      >
        <em class="ft-download"></em>Netsuite Extract
      </button>
    </div>
  </div>
</div>
{% block script %}
  <!-- Download CSV File -->
  <script>
    function DownloadProductsInCSV(id, fileName) {
      var table = document.getElementById(id);

      // Extract headers from the table
      var headers = [];
      var headerRow = table.querySelector("tr");
      var headerCols = headerRow.querySelectorAll("th, td");
      headerCols.forEach(function(col) {
        headers.push('"' + col.innerText.replace(/"/g, '""') + '"');
      });
      var csvContent = headers.join(",") + "\n";

      var rows = table.querySelectorAll("tr");
      for (var i = 1; i < rows.length; i++) {
        var rowData = [];
        var cols = rows[i].querySelectorAll("td");
        cols.forEach(function(col) {
          rowData.push('"' + col.innerText.replace(/"/g, '""') + '"');
        });
        csvContent += rowData.join(",") + "\n";
      }

      var blob = new Blob([csvContent], { type: "text/csv" });

      var url = window.URL.createObjectURL(blob);

      var link = document.createElement("a");
      link.setAttribute("href", url);
      link.setAttribute("download", fileName + ".csv");

      link.click();

      window.URL.revokeObjectURL(url);
    }
  </script>

  <!-- printContent function -->
  <script>
    function printContent(id) {
        // Get the content to print
        var content = document.getElementById(id).innerHTML;
        var originalDocument = document.body.innerHTML;

        // Temporarily replace the document's body content
        document.body.innerHTML = content;

        // Hide icons and any other elements that shouldn't appear in print
        var printStyles = `
            <style>
                /* Hide all icons */
                .icon {
                    display: none !important;
                }
            </style>
        `;
        document.body.insertAdjacentHTML('afterbegin', printStyles);
        document.querySelectorAll('.d-icon').forEach(icon => {
            icon.outerHTML = "*";
        });

        // Function to handle after printing
        function afterPrint() {
            // Restore the original document content
            document.body.innerHTML = originalDocument;
            // Reload the window
            window.location.reload();
        }

        // Create a MutationObserver to wait for content changes
        const observer = new MutationObserver(() => {
            // Call print and then disconnect the observer
            window.print();
            observer.disconnect();
        });

        // Start observing the body for changes
        observer.observe(document.body, {
            childList: true,
            subtree: true
        });

        // Listen for the after print event
        window.onafterprint = afterPrint;

        // If there's a known delay for loading content, you can use setTimeout here
        setTimeout(() => {
            // Trigger the observer manually if needed
            document.body.innerHTML = document.body.innerHTML; // This can help trigger the observer
        }, 1000); // Adjust this delay based on your loading time
    }
  </script>
{% endblock script %}
