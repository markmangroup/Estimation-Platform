{% load static %}

<div class="form-group">
  <div id="proposal">
    <div id="invoice-template" class="card-body pb-0">
      <!-- Invoice Company Details starts -->
      <div id="invoice-company-details" class="row" style="margin-bottom: 35px">
        <div class="col-md-6 col-12">
          <img src="{% static 'app/img/logos/logo.png' %}" alt="" class="img-fluid" width="100" height="100">
        </div>
        <div class="col-md-6 col-12 text-right">
          <h2 class="primary text-uppercase">Exhibit A - Project Detail</h2>
          <p class="pb-3">
            <label class="font-weight-bold form-label" style="">Invoice:</label>
            <input type="text" value="{{ invoice.invoice_number }}" data-id={{ invoice.id }} class="form-control invoice_number" style="width: 200px; float: right;">
          </p>
        </div>
      </div>
      <!-- Invoice Company Details ends -->

      <!-- Invoice Customer Details starts -->
      <div id="invoice-customer-details" class="row">
        <div class="col-12 text-left">
          <p class="mb-1 font-weight-bold">Select Customer</p>
        </div>
        <div class="col-md-2 col-2">
          <select data-document={{opportunity.document_number}} class="customer-select">
              <option selected disabled>{{ opportunity.customer.name }}</option>
          </select>
        </div>
        <div class="col-md-4 col-4">
        </div>
        <div class="col-md-6 col-12 text-right">
          <p>
            <label class="font-weight-bold form-label">Date:</label>
            <input type="date" value="{{ invoice.invoice_data|date:"Y-m-d" }}" data-id="{{ invoice.id }}" class="form-control invoice_date" style="width: 200px; float: right;">
          </p>
          <p>
            <label class="font-weight-bold form-label">Job:</label>
            <input type="text" value="{{ opportunity.job }}" data-id="{{ opportunity.id }}" data-document="{{ opportunity.document_number }}" class="form-control job" style="width: 200px; float: right;">
          </p>
          <p>
            <label class="font-weight-bold form-label">Job Name:</label>
            {% if opportunity.job_name %}
              <input type="text" value="{{ opportunity.job_name }}" data-id="{{ opportunity.id }}"
                data-document="{{ opportunity.document_number }}" class="form-control job_name" style="width: 400px; float: right;">
            {% else %}
              <input type="text" value="" data-id="{{ opportunity.id }}"
                data-document="{{ opportunity.document_number }}" class="form-control job_name" placeholder="Enter Job Name" style="width: 400px; float: right;">
            {% endif %}

          </p>
        </div>
      </div>
      <!-- Invoice Customer Details ends -->

      <!-- Invoice Items Details starts -->
      <div id="invoice-items-details">
        <div class="row">
          <div class="table-responsive col-12">
            <table class="table table-bordered mt-3">
              <thead>
                <th>Group Name</th>
                <th class="text-center">Task Summary</th>
              </thead>
              <tbody>
                {% load custom_filters %}
                {% for grp_name, data in grouped_proposals.items %}
                  <tr>
                    <th scope="row">
                      <input type="text" class="form-control grp_name" data-document="{{opportunity.document_number}}" data-id="{{data.proposal_ids}}" value="{{ grp_name }}">
                    </th>
                    <td>
                      <table class="table">
                        <thead>
                          <tr>
                            <th>Task Code</th>
                            <th>Task Description</th>
                            <th class="text-right">Total</th>
                            <th></th>
                          </tr>
                        </thead>
                        <tbody>
                          {% for task, products in data.assigned_products.items %}
                            <tr>

                              <th scope="row">
                                  <input type="text" data-id="{{ task.id }}" class="form-control task_code" value="{{task.code}}">
                              </th>
                              <td>
                                <p>
                                  <input type="text" data-id="{{ task.id }}" class="form-control task_description" value="{{ task.description }}">
                                </p>
                                {% if task.include %}
                                  <div class="table-responsive">
                                    <table class="table table-bordered">
                                      <thead>
                                        <tr class="text-center">
                                          <th>Item Code</th>
                                          <th>Item Description</th>
                                          <th>Quantity</th>
                                          <th>Price</th>
                                          <th>Total</th>
                                        </tr>
                                      </thead>
                                      <tbody>
                                          {% for p in products %}
                                            <tr class="tr-{{task.id}}">
                                              <td>
                                                {% if p.item_code %}
                                                  <input type="text" data-id="{{p.id}}" class="form-control prod_item_code" value="{{ p.item_code }}"/>
                                                {% else %}
                                                  <input type="text" data-id="{{p.id}}" class="form-control prod_labor_task" value="{{ p.labor_task }}"/>
                                                {% endif %}
                                              </td>
                                              <td>
                                                <input type="text" data-id="{{p.id}}" class="form-control prod_description" value="{{ p.description }}"/>
                                              </td>
                                              <td>
                                                <input type="text" data-id="{{p.id}}" data-task-id={{task.id}} class="form-control prod_quantity" value="{{ p.quantity }}"/>
                                              </td>
                                              <td>
                                                {% if p.standard_cost %}
                                                  <input type="text" data-id="{{p.id}}" data-task-id={{task.id}} class="form-control prod_cost" value="${{ p.standard_cost }}"/>
                                                {% else %}
                                                  <input type="text" data-id="{{p.id}}" data-task-id={{task.id}} class="form-control prod_local_cost" value="${{ p.local_cost }}"/>
                                                {% endif %}
                                              </td>
                                              <td>
                                                {% if p.standard_cost %}
                                                  <input  type="text" data-id="{{p.id}}" class="form-control prod_total" value="${{ p.standard_cost|multiply:p.quantity|round_value:2 }}" disabled>
                                                {% else %}
                                                  <input  type="text" data-id="{{p.id}}" class="form-control prod_total" value="${{ p.local_cost|multiply:p.quantity|round_value:2 }}" disabled>
                                                {% endif %}
                                              </td>
                                            </tr>
                                          {% endfor %}
                                      </tbody>
                                    </table>
                                  </div>
                                {% endif %}

                                {% for description in task.extra_description %}
                                    {% for key, value in description.items %}
                                      <p class="text-muted">
                                        <input type="text"
                                          class="form-control"
                                          value="{{ value }}"
                                          placeholder="write description"
                                          disabled>
                                      </p>
                                    {% endfor %}
                                {% endfor %}
                              </td>
                              <td class="text-right">
                                <input type="text" class="form-control task_total_price_{{task.id}}" value="${{ data.task_totals|get_item:task|round_value:2 }}" disabled>
                              </td>
                              <td>
                                {% if task.task.name %}
                                <button type="button" 
                                        class="btn btn-danger delete-task-btn" 
                                        data-id="{{ data.proposal_ids|get_proposal_id:forloop.counter0 }}" 
                                        data-title="{{task.code}}" 
                                        data-url="{% url 'proposal_app:opportunity:task-delete-ajax' %}">
                                    <em class="fa fa-trash"></em>
                                </button>

                                {% else %}
                                  <button type="button" class="btn btn-danger delete-task-btn" data-id="{{ data.proposal_ids|get_proposal_id:forloop.counter0 }}" data-title="{{task.code}}" data-url="{% url 'proposal_app:opportunity:task-delete-ajax' %}"><em class="fa fa-trash"></em></button>

                                {% endif %}
                              </td>

                            </tr>
                          {% endfor %}
                        </tbody>

                      </table>
                    </td>
                  </tr>
                {% endfor %}

              </tbody>
            </table>

            <table class="table mt-2">
              <p class="font-weight-bold">Options</p>
              <tbody>
                <tr>
                  <th scope="row">Approve & Initial</th>
                  <th>Task</th>
                  <th>Task Description</th>
                  <th class="text-right">Totals</th>
                </tr>

                {% for grp_name, data in grouped_proposals.items %}
                  {% for task, products in data.assigned_products.items %}
                    <tr>
                      <td scope="row">
                        {% if task.approve %}
                          <input type="text" data-id="{{ task.id }}" class="form-control approve" value="{{ task.approve }}" />
                        {% else %}
                          <input type="text" data-id="{{ task.id }}" class="form-control approve" value="Yes / No" />
                        {% endif %}

                      </td>
                      <td>
                        <input type="text" class="form-control" value="{{task.code}}" disabled>
                      </td>
                      <td>
                        <input type="text" class="form-control" value="{{ task.description }}" disabled>
                      </td>
                      <td class="text-right">
                        <input type="text" class="form-control totals task_total_price_{{task.id}}" value="${{ data.task_totals|get_item:task|round_value:2 }}" disabled>
                      </td>
                    </tr>
                  {% endfor %}
                {% endfor %}

                <tr>
                  <th scope="row"></th>
                  <th scope="row"></th>
                  <th class="text-right">
                    <p>TOTAL OPTIONS - ITEMS LISTED :</p>
                  </th>
                  <th class="text-right">
                    <input type="text" class="form-control main_total" value="${{ proposal_total.grand_total_price }}" disabled>
                  </th>
                </tr>
              </tbody>
            </table>

            {% if opportunity.term_and_condition %}
              <!-- Term & Condition and Pipe term-->
              <table class="table main-table">
                <tbody>
                  <tr>
                    <td></td>
                    <td class="text-center">
                      (This job proposal will proceed forward when both a
                      <strong>signed contract</strong> and
                      <strong>deposit</strong> have been received.)
                    </td>
                  </tr>

                  {% for t in opportunity.term_and_condition.term_and_condition %}
                    <tr class="tac-table tac">
                      <!-- <td><i class="fa fa-trash danger remove-terms d-icon"></i></td> -->
                      <td><input type="checkbox" name="" checked></td>
                      <td> <input type="text" class="form-control term" data-id="{{ t.id }}" value="{{ t.text }}"/> </td>
                    </tr>
                  {% endfor %}

                  <!-- Add new Terms -->
                  <tr class="add-new-term-tr tac icon">
                    <!-- <td><i class="fa fa-trash danger remove-terms"></i></td> -->
                    <td><input type="checkbox" name=""></td>
                    <td> <input type="text" class="form-control term new-terms" placeholder="Write new terms..."/> </td>
                  </tr>

                  <tr>
                    <th>*</th>
                    <th>
                      <p class="text-danger">PUMP INSTALLATION TERMS</p>
                    </th>
                  </tr>

                  {% for p in opportunity.term_and_condition.pump_installation_terms %}
                    <tr class="pit">
                      <!-- <td><i class="fa fa-trash danger remove-terms d-icon"></i></td> -->
                      <td><input type="checkbox" name="" checked></td>
                      <td> <input type="text" data-id="{{ p.id }}" class="form-control pump-term" value="{{ p.text }}"/> </td>
                    </tr>
                  {% endfor %}

                  <!-- Add New Row -->
                  <tr class="new-pump-tr pit icon">
                    <!-- <td><i class="fa fa-trash danger remove-terms"></i></td> -->
                    <td><input type="checkbox" name=""></td>
                    <td>
                      <input
                        type="text"
                        class="form-control pump-term new-pump-terms"
                        placeholder="Write new pump installation terms..."
                      />
                    </td>
                  </tr>

                </tbody>
              </table>

              <!-- Sales term -->
              <div>
                <hr>
                <h4 class="text-center">SALES AND APPROVAL AGREEMENT</h4>
                <table class="table">
                  <tbody>
                    {% for s in opportunity.term_and_condition.sales_agreement %}
                      <tr class="spa">
                        <!-- <td><input type="checkbox" name="" checked></td> -->
                        <td style="width: 4%;"><input type="checkbox" name="" checked></td>
                        <td> <input type="text" class="form-control sales-agreement" data-id="{{s.id}}" value="{{s.text}}"/></td>
                      </tr>
                    {% endfor %}
                    <!-- Add New Row -->
                    <tr class="new-sales-agreement-tr spa icon">
                      <!-- <td><i class="fa fa-trash danger remove-terms"></i></td> -->
                      <td style="width: 4%;"><input type="checkbox" name=""></td>
                      <td>
                        <input type="text" class="form-control sales-agreement new-sales-agreement" placeholder="Write new sales and approval agreement..."/>
                      </td>
                    </tr>
                  </tbody>
                </table>

                <!-- Buyer / Seller -->
                <div class="row">

                  <!-- Buyer -->
                  <div class="col-6">
                    <div class="card">
                      <div class="card-body">
                        <div class="row">
                          <div class="col-6 mb-3">
                            <label>Buyer:</label>
                            {% if invoice.buyer %}
                              <input
                                type="text"
                                data-id="{{ invoice.id }}"
                                class="form-control text-nowrap buyer"
                                placeholder="Enter Buyer"
                                value="{{ invoice.buyer }}"
                              />
                            {% else %}
                              <input
                                type="text"
                                data-id="{{ invoice.id }}"
                                class="form-control text-nowrap buyer"
                                placeholder="Enter Buyer"
                              />
                            {% endif %}

                          </div>
                          <div class="col-6 mb-3">
                            <label>Date:</label>
                            <input
                              type="date"
                              data-id="{{ invoice.id }}"
                              class="form-control text-nowrap buyer-date"
                              value="{{ invoice.buyer_date|date:"Y-m-d" }}"
                            />
                          </div>
                          <div class="col-12 mb-3">
                            {% if invoice.buyer_name %}
                              <input
                                type="text"
                                data-id="{{ invoice.id }}"
                                class="form-control text-nowrap buyer-name"
                                placeholder="Enter Name"
                                value="{{ invoice.buyer_name }}"
                              />
                            {% else %}
                              <input
                                type="text"
                                data-id="{{ invoice.id }}"
                                class="form-control text-nowrap buyer-name"
                                placeholder="Enter Name"
                              />
                            {% endif %}

                          </div>

                          <div class="col-12 mb-3">

                            {% if invoice.buyer_position %}
                              <input
                                type="text"
                                data-id="{{ invoice.id }}"
                                class="form-control text-nowrap buyer-position"
                                placeholder="Enter Position"
                                value="{{ invoice.buyer_position }}"
                              />
                            {% else %}
                              <input
                                type="text"
                                data-id="{{ invoice.id }}"
                                class="form-control text-nowrap buyer-position"
                                placeholder="Enter Position"
                              />
                            {% endif %}

                          </div>

                        </div>
                      </div>
                    </div>
                  </div>

                  <!-- Seller -->
                  <div class="col-6">
                    <div class="card">
                      <div class="card-body">
                        <div class="row">

                          <div class="col-6 mb-3">
                            <label>Seller:</label>
                            {% if invoice.seller %}
                              <input
                                type="text"
                                data-id="{{ invoice.id }}"
                                class="form-control text-nowrap seller"
                                placeholder="Enter Buyer"
                                value="{{ invoice.seller }}"
                              />
                            {% else %}
                              <input
                                type="text"
                                data-id="{{ invoice.id }}"
                                class="form-control text-nowrap seller"
                                placeholder="Enter Buyer"
                              />
                            {% endif %}
                          </div>

                          <div class="col-6 mb-3">
                            <label>Date:</label>
                            <input
                              type="date"
                              data-id="{{ invoice.id }}"
                              class="form-control text-nowrap seller-date"
                              value="{{ invoice.seller_date|date:"Y-m-d" }}"
                            />
                          </div>

                          <div class="col-12 mb-3">
                            {% if invoice.seller_name %}
                              <input
                                type="text"
                                data-id="{{ invoice.id }}"
                                class="form-control text-nowrap seller-name"
                                placeholder="Enter Name"
                                value="{{ invoice.seller_name }}"
                              />
                            {% else %}
                              <input
                                type="text"
                                data-id="{{ invoice.id }}"
                                class="form-control text-nowrap seller-name"
                                placeholder="Enter Name"
                              />
                            {% endif %}

                          </div>

                          <div class="col-12 mb-3">
                            {% if invoice.seller_position %}
                              <input
                                type="text"
                                data-id="{{ invoice.id }}"
                                class="form-control text-nowrap seller-position"
                                placeholder="Enter Position"
                                value="{{ invoice.seller_position }}"
                              />
                            {% else %}
                              <input
                                type="text"
                                data-id="{{ invoice.id }}"
                                class="form-control text-nowrap seller-position"
                                placeholder="Enter Position"
                              />
                            {% endif %}
                          </div>

                        </div>
                      </div>
                    </div>
                  </div>
                </div>

                <!-- DEPOSIT INVOICE -->
                <div>
                  <hr>
                  <h4 class="text-center">DEPOSIT INVOICE</h4>
                  <strong>Customer: </strong>
                  <input type="text" class="form-control text-nowrap" value="{{ opportunity.customer.name }}" placeholder="Customer Name"
                  disabled>
                  <div class="d-flex justify-content-between my-4" style="gap: 50px">
                    <div class="w-50">
                      <strong class="w-100"> Date :</strong>
                      <span class="ml-3">
                        <input
                          type="date" class="form-control text-nowrap invoice_date" data-id="{{ invoice.id }}"value="{{ invoice.invoice_data|date:"Y-m-d" }}">
                      </span>
                    </div>

                    <div class="w-50">
                      <strong class="w-100"> Job :</strong>
                      <span class="ml-3">
                        {% if opportunity.job %}
                          <input
                            type="text"
                            class="form-control text-nowrap job"
                            data-document="{{ opportunity.document_number }}"
                            value="{{ opportunity.job }}"
                          />
                        {% else %}
                          <input
                            type="text"
                            class="form-control text-nowrap job"
                            data-document="{{ opportunity.document_number }}"
                            value=""
                            placeholder="Enter Job"
                          />
                        {% endif %}

                      </span>
                    </div>
                  </div>

                  <div class="d-flex justify-content-between my-4" style="gap: 50px">
                    <div class="w-100">
                      <strong>
                        To:
                        {% if invoice.deposit_address %}
                          <input
                            type="text"
                            data-id="{{ invoice.id }}"
                            class="form-control text-nowrap to-address"
                            value="{{ invoice.deposit_address }}"
                            placeholder = "Enter Address"
                          />
                        {% else %}
                          <input
                            type="text"
                            data-id="{{ invoice.id }}"
                            class="form-control text-nowrap to-address"
                            value=""
                            placeholder = "Enter Address"
                          />
                        {% endif %}

                      </strong>
                    </div>

                    <div class="w-100">
                      <strong class="w-100">
                        Ranch Name:
                        {% if opportunity.ranch_name %}
                          <input type="text" class="form-control text-nowrap ranch" data-document="{{opportunity.document_number}}"
                          value="{{ opportunity.ranch_name }}" placeholder="Enter Ranch Name"/>
                        {% else %}
                          <input type="text" class="form-control text-nowrap ranch" data-document="{{opportunity.document_number}}"
                          value="" placeholder="Enter Ranch Name"/>
                        {% endif %}
                        </strong>
                      <div class="w-100 mt-2">
                        <strong>
                          Job Name:
                          {% if opportunity.job_name %}
                            <input
                              type="text"
                              class="form-control text-nowrap job_name"
                              data-document="{{ opportunity.document_number }}"
                              value="{{ opportunity.job_name }}"
                            />
                          {% else %}
                            <input
                              type="text"
                              class="form-control text-nowrap job_name"
                              data-document="{{ opportunity.document_number }}"
                              value=""
                              placeholder="Enter Job Name"
                            />
                          {% endif %}
                        </strong>
                      </div>
                    </div>

                  </div>

                  <table class="table">
                    <thead class="thead-light">
                      <th>DESCRIPTION</th>
                      <th></th>
                      <th class="text-right">Amount</th>
                    </thead>

                    <tbody>
                      <tr>
                        <td>Deposit for:</td>
                        <td></td>
                        <td class="text-right">
                          <input
                            type="text"
                            class="form-control text-nowrap deposit"
                            data-id="{{ invoice.id }}"
                            value="${{ invoice.deposit_amount }}"
                          />
                        </td>
                      </tr>
                      <tr>
                        <td>Job:</td>
                        <td></td>
                        <td class="text-right">
                          <input
                            type="text"
                            class="form-control text-nowrap job"
                            value="{{ opportunity.job }}"
                            disabled
                          />
                        </td>
                      </tr>
                      <tr>
                        <td>Ranch:</td>
                        <td></td>
                        {% if opportunity.ranch_name %}
                          <td class="text-right">
                            <input
                              type="text"
                              class="form-control text-nowrap ranch"
                              placeholder="Enter Ranch"
                              data-document="{{opportunity.document_number}}"
                              value="{{ opportunity.ranch_name }}"
                              disabled
                            />
                          </td>
                        {% else %}
                          <td class="text-right">
                            <input
                              type="text"
                              class="form-control text-nowrap"
                              placeholder="Enter Ranch"
                              value=""
                            />
                          </td>
                        {% endif %}
                      </tr>
                      <tr>
                        <td>Job Name:</td>
                        <td></td>
                        <td class="text-right">
                          <input
                            type="text"
                            class="form-control text-nowrap"
                            value="{{ opportunity.job_name }}"
                            disabled
                          />
                        </td>
                      </tr>
                    </tbody>
                  </table>

                  <table class="table">
                    <tbody>
                      <tr>
                        <th>
                          Contract Terms: As per your contract, this job billing
                          is due upon receipt.
                        </th>
                        <th></th>
                      </tr>

                      <tr>
                        <td class="text-right">Remit to:</td>
                        <td class="text-right">
                          {% if invoice.billing_address %}
                            <input type="text" class="form-control text-nowrap address"
                            data-id="{{ invoice.id }}"
                            value="{{ invoice.billing_address }}" placeholder="Enter Address">
                          {% else %}
                            <input type="text" class="form-control text-nowrap address" data-id="{{ invoice.id }}" value="" placeholder="Enter Address">
                          {% endif %}
                        </td>
                      </tr>
                      <tr>
                        <td class="text-right">SUBTOTAL</td>
                        <td class="text-right">
                          <input type="text" class="form-control text-nowrap main_total" value="${{ proposal_total.grand_total_price }}"
                          disabled>
                        </td>
                      </tr>

                      <tr>
                        <td class="text-right">TAX RATE</td>
                        <td class="text-right">
                          <input type="text"
                          data-id="{{ invoice.id }}"
                          class="form-control text-nowrap tax_rate" value="{{ invoice.tax_rate }}%">
                        </td>
                      </tr>

                      <tr>
                        <td class="text-right">SALES TAX</td>
                        <td class="text-right">
                          <input  type="text"
                          data-id="{{ invoice.id }}" class="form-control text-nowrap invoice_sales_tax" value="${{ invoice.sales_tax }}">
                        </td>
                      </tr>

                      <tr>
                        <td>
                          <div class="d-flex justify-content-between">
                            <strong> THANK YOU FOR YOUR BUSINESS! </strong>
                            <p>OTHER</p>
                          </div>
                        </td>
                        <td class="text-right">
                          <input type="text"
                          data-id="{{ invoice.id }}" class="form-control text-nowrap
                          other_tax" placeholder="Enter Other value" value="${{ invoice.other_tax }}">
                        </td>
                      </tr>

                      <tr>
                        <th class="text-right">TOTAL</th>
                        <th class="text-right">
                          <input type="text" class="form-control text-nowrap grand_total" value="${{ proposal_total.final_total_price }}" disabled>
                        </th>
                      </tr>
                    </tbody>
                  </table>
                </div>

                <br>

              </div>

            <!-- Hard coded terms -->
            {% else %}
              <!-- Term & Condition and Pipe term-->
              <table class="table">
                <tbody>
                  <tr>
                    <td></td>
                    <td class="text-center">
                      (This job proposal will proceed forward when both a
                      <strong>signed contract</strong> and
                      <strong>deposit</strong> have been received.)
                    </td>
                  </tr>

                  <tr class="tac">
                    <td><input type="checkbox" name="" checked></td>
                    <td>
                      <input
                        type="text"
                        class="form-control term"
                        data-id="1"
                        value="This proposal is good for 14 days from presentation date of _______________."
                      />
                    </td>
                  </tr>

                  <tr class="tac">
                    <td><input type="checkbox" name="" checked></td>
                    <td>
                      <input
                        type="text"
                        data-id="2"
                        class="form-control term"
                        value="Additional Labor to be Billed for Unforeseen Column Tube and Shaft Condition"
                      />
                    </td>
                  </tr>

                  <tr class="tac">
                    <td><input type="checkbox" name="" checked></td>
                    <td>
                      <input
                        type="text"
                        data-id="3"
                        class="form-control term"
                        value="System flushing & start-up is included."
                      />
                    </td>
                  </tr>

                  <tr class="tac">
                    <td><input type="checkbox" name="" checked></td>
                    <td>
                      <input
                        type="text"
                        data-id="4"
                        class="form-control term"
                        value="Any alteration or deviation from the contract specifications will become an additional charge over and above the original price."
                      />
                    </td>
                  </tr>

                  <tr class="tac">
                    <td><input type="checkbox" name="" checked></td>
                    <td>
                      <input
                        type="text"
                        data-id="5"
                        class="form-control term"
                        value="Sub-surfaces not free of obstructions, obstacles, or unusual conditions of any kind including, by way of example and not limited to high water table, mud, large and/or excessive rock, roots, water, or utility lines will increase the cost of trenching or other installation work."
                      />
                    </td>
                  </tr>

                  <tr class="tac">
                    <td><input type="checkbox" name="" checked></td>
                    <td>
                      <input
                        type="text"
                        data-id="6"
                        class="form-control term"
                        value="Laurel Ag & Water is not responsible for the replacement of marking pegs which can be disrupted during installation."
                      />
                    </td>
                  </tr>

                  <tr class="tac">
                    <td><input type="checkbox" name="" checked></td>
                    <td>
                      <input
                        type="text"
                        data-id="7"
                        class="form-control term"
                        value="All rocks removed from excavated soil to be placed along the side of the ditch."
                      />
                    </td>
                  </tr>

                  <tr class="tac">
                    <td><input type="checkbox" name="" checked></td>
                    <td>
                      <input
                        type="text"
                        data-id="8"
                        class="form-control term"
                        value="Trench cave-in due to unstable ground will require additional labor."
                      />
                    </td>
                  </tr>

                  <tr class="tac">
                    <td><input type="checkbox" name="" checked></td>
                    <td>
                      <input
                        type="text"
                        data-id="9"
                        class="form-control term"
                        value="This proposal does not include shading the ditch with sand. Backfill with existing soil."
                      />
                    </td>
                  </tr>

                  <tr class="tac">
                    <td><input type="checkbox" name="" checked></td>
                    <td>
                      <input
                        type="text"
                        data-id="10"
                        class="form-control term"
                        value="Repair of the road crossing not included."
                      />
                    </td>
                  </tr>

                  <tr class="tac">
                    <td><input type="checkbox" name="" checked></td>
                    <td>
                      <input
                        type="text"
                        data-id="11"
                        class="form-control term"
                        value="Trench compaction not included."
                      />
                    </td>
                  </tr>

                  <tr class="tac">
                    <td><input type="checkbox" name="" checked></td>
                    <td>
                      <input
                        type="text"
                        data-id="12"
                        class="form-control term"
                        value="All existing irrigation & utility lines to be located & exposed by the customer."
                      />
                    </td>
                  </tr>

                  <tr class="tac">
                    <td><input type="checkbox" name="" checked></td>
                    <td>
                      <input
                        type="text"
                        data-id="13"
                        class="form-control term"
                        value="The customer is responsible for any materials delivered by Laurel Ag & Water, or its suppliers, and stored on the job site. Customer shall indemnify and hold Laurel Ag & Water harmless for any losses or damages to said materials."
                      />
                    </td>
                  </tr>

                  <tr class="tac">
                    <td><input type="checkbox" name="" checked></td>
                    <td>
                      <input
                        type="text"
                        class="form-control term"
                        data-id="14"
                        value="Preliminary Notice to be furnished to Landowner, Contractor, and Lender (if applicable)."
                      />
                    </td>
                  </tr>

                  <tr class="tac">
                    <td><input type="checkbox" name="" checked></td>
                    <td>
                      <input
                        type="text"
                        class="form-control term"
                        data-id="15"
                        value="Any alteration or deviation from the contract specifications will become an additional charge over and above the original price."
                      />
                    </td>
                  </tr>

                  <tr class="tac">
                    <td><input type="checkbox" name="" checked></td>
                    <td>
                      <input
                        type="text"
                        class="form-control term"
                        data-id="16"
                        value="Preliminary Notice to be furnished to Landowner, Contractor, and Lender (if applicable)."
                      />
                    </td>
                  </tr>

                  <!-- Add new Terms -->
                  <tr class="tac">
                    <td><input type="checkbox" name=""></td>
                    <td>
                      <input
                        type="text"
                        class="form-control term new-terms"
                        placeholder="Write Here Term & Condition"
                      />
                    </td>
                  </tr>

                  <tr>
                    <th>*</th>
                    <th>
                      <p class="text-danger">PUMP INSTALLATION TERMS</p>
                    </th>
                  </tr>

                  <tr class="pit">
                    <td><input type="checkbox" name="" checked></td>
                    <td>
                      <input
                        type="text"
                        data-id="1"
                        class="form-control pump-term"
                        value="This proposal does not include utility connection fees."
                      />
                    </td>
                  </tr>

                  <tr class="pit">
                    <td><input type="checkbox" name="" checked></td>
                    <td>
                      <input
                        type="text"
                        data-id="2"
                        class="form-control pump-term"
                        value="Concrete pad to be provided by Customer."
                      />
                    </td>
                  </tr>

                  <tr class="pit">
                    <td><input type="checkbox" name="" checked></td>
                    <td>
                      <input
                        type="text"
                        data-id="3"
                        class="form-control pump-term"
                        value="Tank plumbing and connection not included."
                      />
                    </td>
                  </tr>

                  <tr class="pit">
                    <td><input type="checkbox" name="" checked></td>
                    <td>
                      <input
                        type="text"
                        data-id="4"
                        class="form-control pump-term"
                        value="Labor to remove existing pump and install new pump included."
                      />
                    </td>
                  </tr>

                  <tr class="pit">
                    <td><input type="checkbox" name="" checked></td>
                    <td>
                      <input
                        type="text"
                        data-id="5"
                        class="form-control pump-term"
                        value="Labor to install new pump is included."
                      />
                    </td>
                  </tr>

                  <tr class="pit">
                    <td><input type="checkbox" name="" checked></td>
                    <td>
                      <input
                        type="text"
                        data-id="6"
                        class="form-control pump-term"
                        value="Verification on well log/pump test is not included."
                      />
                    </td>
                  </tr>

                  <tr class="pit">
                    <td><input type="checkbox" name="" checked></td>
                    <td>
                      <input
                        type="text"
                        data-id="7"
                        class="form-control pump-term"
                        value="Customer to provide power to operate system."
                      />
                    </td>
                  </tr>

                  <tr class="pit">
                    <td><input type="checkbox" name="" checked></td>
                    <td>
                      <input
                        type="text"
                        data-id="8"
                        class="form-control pump-term"
                        value="This quote is based on connection to an existing pump panel and electrical service."
                      />
                    </td>
                  </tr>

                  <tr class="pit">
                    <td><input type="checkbox" name="" checked></td>
                    <td>
                      <input
                        type="text"
                        data-id="9"
                        class="form-control pump-term"
                        value="Proposal does not include any permits if required. Owner/Manager is responsible for obtaining all permits."
                      />
                    </td>
                  </tr>

                  <tr class="pit">
                    <td><input type="checkbox" name="" checked></td>
                    <td>
                      <input
                        type="text"
                        data-id="10"
                        class="form-control pump-term"
                        value="This price does not include new electrical service, meter main, permit, or inspection if required."
                      />
                    </td>
                  </tr>

                  <tr class="pit">
                    <td><input type="checkbox" name="" checked></td>
                    <td>
                      <input
                        type="text"
                        data-id="11"
                        class="form-control pump-term"
                        value="Cave-in due to unstable ground will require additional labor."
                      />
                    </td>
                  </tr>

                  <tr class="pit">
                    <td><input type="checkbox" name="" checked></td>
                    <td>
                      <input
                        type="text"
                        data-id="12"
                        class="form-control pump-term"
                        value="Sub-surfaces not free of obstructions, obstacles, or unusual conditions of any kind including, by way of example and not limited to, high water table, mud, large and/or excessive rock, roots, water, or utility lines will increase the cost of trenching or other installation work."
                      />
                    </td>
                  </tr>

                  <tr class="pit">
                    <td><input type="checkbox" name="" checked></td>
                    <td>
                      <input
                        type="text"
                        data-id="13"
                        class="form-control pump-term"
                        value="Not responsible for any issues with the well that may be the result of unknown conditions."
                      />
                    </td>
                  </tr>

                  <tr class="pit">
                    <td><input type="checkbox" name="" checked></td>
                    <td>
                      <input
                        type="text"
                        data-id="14"
                        class="form-control pump-term"
                        value="Pump Discharge Modification not included (available at an additional cost)."
                      />
                    </td>
                  </tr>

                  <tr class="pit">
                    <td><input type="checkbox" name="" checked></td>
                    <td>
                      <input
                        type="text"
                        data-id="15"
                        class="form-control pump-term"
                        value="Motor reconditioning not included."
                      />
                    </td>
                  </tr>

                  <tr class="pit">
                    <td><input type="checkbox" name="" checked></td>
                    <td>
                      <input
                        type="text"
                        data-id="16"
                        class="form-control pump-term"
                        value="Quote based on using existing pump hardware. Anything requiring replacement will be an additional cost to the job."
                      />
                    </td>
                  </tr>

                  <tr class="pit">
                    <td><input type="checkbox" name="" checked></td>
                    <td>
                      <input
                        type="text"
                        data-id="17"
                        class="form-control pump-term"
                        value="Preliminary Notice to be furnished to Landowner, Contractor, and Lender (if applicable)."
                      />
                    </td>
                  </tr>

                  <tr class="pit">
                    <td><input type="checkbox" name="" checked></td>
                    <td>
                      <input
                        type="text"
                        data-id="18"
                        class="form-control pump-term"
                        value="The customer is responsible for any materials delivered by Laurel Ag & Water, or its suppliers, and stored on the jobsite. Customer shall indemnify and hold Laurel Ag & Water harmless for any losses or damages to said materials."
                      />
                    </td>
                  </tr>

                  <tr class="pit">
                    <td><input type="checkbox" name="" checked></td>
                    <td>
                      <input
                        type="text"
                        data-id="19"
                        class="form-control pump-term"
                        value="Laurel Ag & Water is not responsible for theft or vandalism of components or facilities that are under repair (for example; motor, bowls, column pipe and tube & shaft) and are stored at the customer's location. Laurel Ag & Water can transport to our location and store, at the customer's request, for an additional charge."
                      />
                    </td>
                  </tr>

                  <tr class="pit">
                    <td><input type="checkbox" name="" checked></td>
                    <td>
                      <input
                        type="text"
                        data-id="20"
                        class="form-control pump-term"
                        value="Customer Responsible for Determination of Flood Plain Requirements at Construction Site."
                      />
                    </td>
                  </tr>
                  
                  <!-- Add More -->
                  <tr class="pit">
                    <td><input type="checkbox" name=""></td>
                    <td>
                      <input
                        type="text"
                        class="form-control pump-term new-pump-terms"
                        placeholder="write here pump installation terms..."
                      />
                    </td>
                  </tr>

                </tbody>
              </table>

              <!-- Sales term -->
              <div>
                <hr>
                <h4 class="text-center">SALES AND APPROVAL AGREEMENT</h4>
                <table class="table">
                  <tbody>

                    <tr class="spa">
                      <td style="width: 4%;"><input type="checkbox" name="" checked></td>
                      <td>
                        <input
                      type="text"
                      class="form-control sales-agreement"
                      data-id="1"
                      value="This Agreement is made and entered on _______________ by and between Laurel Ag & Water (“Seller”) and Martha Waterman, (“Buyer”), (collectively referred to as the “Parties”)."
                      />
                      </td>
                    </tr>

                    <tr class="spa">
                      <td style="width: 4%;"><input type="checkbox" name="" checked></td>
                      <td>
                        <input
                      type="text"
                      data-id="2"
                      class="form-control sales-agreement"
                      value="SELLER AGREES TO SELL and Buyer agrees to buy all material and services more fully described in the attached Exhibit A, “Project Detail” (the “Goods”), Job #Existi."
                      />
                      </td>
                    </tr>

                    <tr class="spa">
                      <td style="width: 4%;"><input type="checkbox" name="" checked></td>
                      <td>
                        <input
                      type="text"
                      data-id="3"
                      class="form-control sales-agreement"
                      value='BUYER SHALL PAY SELLER $37,498 for the Goods, the “Purchase Price”. Buyer shall make an initial deposit of 30% of the Purchase Price in the amount of $11,249 for Seller to secure materials. Buyer shall make a second installment payment of 30% in the amount of $11,249 upon first delivery of materials. Buyer shall make a third installment payment of 30% in the amount of $11,249 at commencement of infield work. Buyer shall make a final installment payment of 10% in the amount of $3,749 upon successful testing of system. All payments shall be fully applied to the Purchase Price. In addition to the Purchase Price, BUYER AGREES TO PAY for all approved and initialed options in the attached Exhibit A, "Project Detail."'
                      />
                      </td>
                    </tr>

                    <tr class="spa">
                      <td style="width: 4%;"><input type="checkbox" name="" checked></td>
                      <td>
                        <input
                      type="text"
                      data-id="4"
                      class="form-control text-nowrap sales-agreement"
                      value="THE BUYER SHALL PAY THE PURCHASE PRICE, less the initial deposit, upon the completion of the job, or upon receipt of Invoice, whichever is first. Buyer agrees to pay 1.5% monthly interest (18% annual rate) on any unpaid balance remaining due more than thirty (30) days. Buyer agrees to pay for any collection or legal expenses incurred by Seller due to late payment or non-payment."
                      />
                      </td>
                    </tr>

                    <tr class="spa">
                      <td style="width: 4%;"><input type="checkbox" name="" checked></td>
                      <td>
                        <input
                      type="text"
                      data-id="5"
                      class="form-control text-nowrap sales-agreement"
                      value="SELLER SHALL DELIVER the Goods to Buyer at the following address or parcel number: _______________. At that time, Buyer has the right to inspect the Goods. Buyer must give notice to Seller of any defect, damage or other problems with the Goods. If Buyer does not notify Seller within 48 hours after delivery of the Goods, Buyer shall conclusively be presumed to have inspected and accepted them. Buyer assumes all liability for loss due to acts of God, earthquake, fire, explosion, vandalism, storm, flood, theft or other similar occurrence."
                      />
                      </td>
                    </tr>

                    <tr class="spa">
                      <td style="width: 4%;"><input type="checkbox" name="" checked></td>
                      <td>
                        <input
                      type="text"
                      data-id="6"
                      class="form-control text-nowrap sales-agreement"
                      value="PRELIMINARY NOTICE will be furnished to the Landowner, Contractor and Lender."
                      />
                      </td>
                    </tr>

                    <tr class="spa">
                      <td style="width: 4%;"><input type="checkbox" name="" checked></td>
                      <td>
                        <input
                      type="text"
                      data-id="7"
                      class="form-control text-nowrap sales-agreement"
                      value="ANY CHANGES OR ADDITIONS made to the original Project Detail including the charges associated with them will subsequently be referred to as “Change Order(s)” and/or “Addition Order(s)” and become part of this Agreement including all of its terms and conditions."
                      />
                      </td>
                    </tr>

                    <tr class="spa">
                      <td style="width: 4%;"><input type="checkbox" name="" checked></td>
                      <td>
                        <input
                      type="text"
                      data-id="8"
                      class="form-control text-nowrap sales-agreement"
                      value="BUYER AGREES that the design and specifications as described in the Project Detail are accurate and will be governed by the remaining terms of this Agreement."
                      />
                      </td>
                    </tr>

                    <tr class="spa">
                      <td style="width: 4%;"><input type="checkbox" name="" checked></td>
                      <td>
                        <input
                      type="text"
                      data-id="9"
                      class="form-control text-nowrap sales-agreement"
                      value="IN WITNESS WHEREOF, the parties have caused this Agreement to be executed the day and year first above written."
                      />
                      </td>
                    </tr>

                    <tr class="new-sales-agreement-tr spa icon">
                      <td style="width: 4%;"><input type="checkbox" name=""></td>
                      <td>
                        <input
                          type="text"
                          class="form-control sales-agreement new-sales-agreement"
                          placeholder="Write new sales and approval agreement..."
                        />
                      </td>
                    </tr>

                  </tbody>
                </table>

                <!-- Buyer / Seller -->
                <div class="row">

                  <!-- Buyer -->
                  <div class="col-6">
                    <div class="card">
                      <div class="card-body">
                        <div class="row">
                          <div class="col-6 mb-3">
                            <label>Buyer:</label>
                            {% if invoice.buyer %}
                              <input
                                type="text"
                                data-id="{{ invoice.id }}"
                                class="form-control text-nowrap buyer"
                                placeholder="Enter Buyer"
                                value="{{ invoice.buyer }}"
                              />
                            {% else %}
                              <input
                                type="text"
                                data-id="{{ invoice.id }}"
                                class="form-control text-nowrap buyer"
                                placeholder="Enter Buyer"
                              />
                            {% endif %}

                          </div>
                          <div class="col-6 mb-3">
                            <label>Date:</label>
                            <input
                              type="date"
                              data-id="{{ invoice.id }}"
                              class="form-control text-nowrap buyer-date"
                              value="{{ invoice.buyer_date|date:"Y-m-d" }}"
                            />
                          </div>
                          <div class="col-12 mb-3">
                            {% if invoice.buyer_name %}
                              <input
                                type="text"
                                data-id="{{ invoice.id }}"
                                class="form-control text-nowrap buyer-name"
                                placeholder="Enter Name"
                                value="{{ invoice.buyer_name }}"
                              />
                            {% else %}
                              <input
                                type="text"
                                data-id="{{ invoice.id }}"
                                class="form-control text-nowrap buyer-name"
                                placeholder="Enter Name"
                              />
                            {% endif %}

                          </div>
                          <div class="col-12 mb-3">

                            {% if invoice.buyer_position %}
                              <input
                                type="text"
                                data-id="{{ invoice.id }}"
                                class="form-control text-nowrap buyer-position"
                                placeholder="Enter Position"
                                value="{{ invoice.buyer_position }}"
                              />
                            {% else %}
                              <input
                                type="text"
                                data-id="{{ invoice.id }}"
                                class="form-control text-nowrap buyer-position"
                                placeholder="Enter Position"
                              />
                            {% endif %}

                          </div>
                        </div>
                      </div>
                    </div>
                  </div>

                  <!-- Seller -->
                  <div class="col-6">
                    <div class="card">
                      <div class="card-body">
                        <div class="row">
                          <div class="col-6 mb-3">
                            <label>Seller:</label>
                            {% if invoice.seller %}
                              <input
                                type="text"
                                data-id="{{ invoice.id }}"
                                class="form-control text-nowrap seller"
                                placeholder="Enter Buyer"
                                value="{{ invoice.seller }}"
                              />
                            {% else %}
                              <input
                                type="text"
                                data-id="{{ invoice.id }}"
                                class="form-control text-nowrap seller"
                                placeholder="Enter Buyer"
                              />
                            {% endif %}
                          </div>
                          <div class="col-6 mb-3">
                            <label>Date:</label>
                            <input
                              type="date"
                              data-id="{{ invoice.id }}"
                              class="form-control text-nowrap seller-date"
                              value="{{ invoice.seller_date|date:"Y-m-d" }}"
                            />
                          </div>
                          <div class="col-12 mb-3">
                            {% if invoice.seller_name %}
                              <input
                                type="text"
                                data-id="{{ invoice.id }}"
                                class="form-control text-nowrap seller-name"
                                placeholder="Enter Name"
                                value="{{ invoice.seller_name }}"
                              />
                            {% else %}
                              <input
                                type="text"
                                data-id="{{ invoice.id }}"
                                class="form-control text-nowrap seller-name"
                                placeholder="Enter Name"
                              />
                            {% endif %}

                          </div>
                          <div class="col-12 mb-3">
                            {% if invoice.seller_position %}
                              <input
                                type="text"
                                data-id="{{ invoice.id }}"
                                class="form-control text-nowrap seller-position"
                                placeholder="Enter Position"
                                value="{{ invoice.seller_position }}"
                              />
                            {% else %}
                              <input
                                type="text"
                                data-id="{{ invoice.id }}"
                                class="form-control text-nowrap seller-position"
                                placeholder="Enter Position"
                              />
                            {% endif %}
                          </div>
                        </div>
                      </div>
                    </div>
                  </div>
                </div>

                <!-- DEPOSIT INVOICE -->
                <div>
                  <hr>
                  <h4 class="text-center">DEPOSIT INVOICE</h4>
                  <strong>Customer: </strong>
                  <input type="text" class="form-control text-nowrap" value="{{ opportunity.customer.name }}" placeholder="Customer Name"
                  disabled>
                  <div class="d-flex justify-content-between my-4" style="gap: 50px">
                    <div class="w-50">
                      <strong class="w-100"> Date :</strong>
                      <span class="ml-3">
                        <input
                          type="date" class="form-control text-nowrap invoice_date" data-id="{{ invoice.id }}"value="{{ invoice.invoice_data|date:"Y-m-d" }}">
                      </span>
                    </div>

                    <div class="w-50">
                      <strong class="w-100"> Job :</strong>
                      <span class="ml-3">
                        {% if opportunity.job %}
                          <input
                            type="text"
                            class="form-control text-nowrap job"
                            data-document="{{ opportunity.document_number }}"
                            value="{{ opportunity.job }}"
                          />
                        {% else %}
                          <input
                            type="text"
                            class="form-control text-nowrap job"
                            data-document="{{ opportunity.document_number }}"
                            value=""
                            placeholder="Enter Job"
                          />
                        {% endif %}

                      </span>
                    </div>
                  </div>

                  <div class="d-flex justify-content-between my-4" style="gap: 50px">
                    <div class="w-100">
                      <strong>
                        To:
                        {% if invoice.deposit_address %}
                          <input
                            type="text"
                            data-id="{{ invoice.id }}"
                            class="form-control text-nowrap to-address"
                            value="{{ invoice.deposit_address }}"
                            placeholder = "Enter Address"
                          />
                        {% else %}
                          <input
                            type="text"
                            data-id="{{ invoice.id }}"
                            class="form-control text-nowrap to-address"
                            value=""
                            placeholder = "Enter Address"
                          />
                        {% endif %}

                      </strong>
                    </div>

                    <div class="w-100">
                      <strong class="w-100">
                        Ranch Name:
                        {% if opportunity.ranch_name %}
                          <input type="text" class="form-control text-nowrap ranch" data-document="{{opportunity.document_number}}"
                          value="{{ opportunity.ranch_name }}" placeholder="Enter Ranch Name"/>
                        {% else %}
                          <input type="text" class="form-control text-nowrap ranch" data-document="{{opportunity.document_number}}"
                          value="" placeholder="Enter Ranch Name"/>
                        {% endif %}
                        </strong>
                      <div class="w-100 mt-2">
                        <strong>
                          Job Name:
                          {% if opportunity.job_name %}
                            <input
                              type="text"
                              class="form-control text-nowrap job_name"
                              data-document="{{ opportunity.document_number }}"
                              value="{{ opportunity.job_name }}"
                            />
                          {% else %}
                            <input
                              type="text"
                              class="form-control text-nowrap job_name"
                              data-document="{{ opportunity.document_number }}"
                              value=""
                              placeholder="Enter Job Name"
                            />
                          {% endif %}
                        </strong>
                      </div>
                    </div>
                  </div>

                  <table class="table">
                    <thead class="thead-light">
                      <th>DESCRIPTION</th>
                      <th></th>
                      <th class="text-right">Amount</th>
                    </thead>

                    <tbody>
                      <tr>
                        <td>Deposit for:</td>
                        <td></td>
                        <td class="text-right">
                          <input
                            type="text"
                            class="form-control text-nowrap deposit"
                            data-id="{{ invoice.id }}"
                            value="${{ invoice.deposit_amount }}"
                          />
                        </td>
                      </tr>
                      <tr>
                        <td>Job:</td>
                        <td></td>
                        <td class="text-right">
                          <input
                            type="text"
                            class="form-control text-nowrap job"
                            value="{{ opportunity.job }}"
                            disabled
                          />
                        </td>
                      </tr>
                      <tr>
                        <td>Ranch:</td>
                        <td></td>
                        {% if opportunity.ranch_name %}
                          <td class="text-right">
                            <input
                              type="text"
                              class="form-control text-nowrap ranch"
                              placeholder="Enter Ranch"
                              data-document="{{opportunity.document_number}}"
                              value="{{ opportunity.ranch_name }}"
                              disabled
                            />
                          </td>
                        {% else %}
                          <td class="text-right">
                            <input
                              type="text"
                              class="form-control text-nowrap ranch"
                              placeholder="Enter Ranch"
                              value=""
                            />
                          </td>
                        {% endif %}
                      </tr>
                      <tr>
                        <td>Job Name:</td>
                        <td></td>
                        <td class="text-right">
                          <input
                            type="text"
                            class="form-control text-nowrap"
                            value="{{ opportunity.job_name }}"
                            disabled
                          />
                        </td>
                      </tr>
                    </tbody>
                  </table>

                  <table class="table">
                    <tbody>
                      <tr>
                        <th>
                          Contract Terms: As per your contract, this job billing
                          is due upon receipt.
                        </th>
                        <th></th>
                      </tr>

                      <tr>
                        <td class="text-right">Remit to:</td>
                        <td class="text-right">
                          {% if invoice.billing_address %}
                            <input type="text" class="form-control text-nowrap address"
                            data-id="{{ invoice.id }}"
                            value="{{ invoice.billing_address }}" placeholder="Enter Address">
                          {% else %}
                            <input type="text" class="form-control text-nowrap address" data-id="{{ invoice.id }}" value="" placeholder="Enter Address">
                          {% endif %}
                        </td>
                      </tr>
                      <tr>
                        <td class="text-right">SUBTOTAL</td>
                        <td class="text-right">
                          <input type="text" class="form-control text-nowrap main_total" value="${{ proposal_total.grand_total_price }}"
                          disabled>
                        </td>
                      </tr>

                      <tr>
                        <td class="text-right">TAX RATE</td>
                        <td class="text-right">
                          <input type="text"
                          data-id="{{ invoice.id }}"
                          class="form-control text-nowrap tax_rate" value="{{ invoice.tax_rate }}%">
                        </td>
                      </tr>

                      <tr>
                        <td class="text-right">SALES TAX</td>
                        <td class="text-right">
                          <input  type="text"
                          data-id="{{ invoice.id }}" class="form-control text-nowrap invoice_sales_tax" value="${{ invoice.sales_tax }}">
                        </td>
                      </tr>

                      <tr>
                        <td>
                          <div class="d-flex justify-content-between">
                            <strong> THANK YOU FOR YOUR BUSINESS! </strong>
                            <p>OTHER</p>
                          </div>
                        </td>
                        <td class="text-right">
                          <input type="text"
                          data-id="{{ invoice.id }}" class="form-control text-nowrap
                          other_tax" placeholder="Enter Other value" value="${{ invoice.other_tax }}">
                        </td>
                      </tr>

                      <tr>
                        <th class="text-right">TOTAL</th>
                        <th class="text-right">
                          <input type="text" class="form-control text-nowrap grand_total" value="${{ proposal_total.final_total_price }}" disabled>
                        </th>
                      </tr>
                    </tbody>
                  </table>
                </div>
                <br>
              </div>

              <!-- Invoice Items Details ends -->
            {% endif %}

          </div>
        </div>
      </div>
    </div>
  </div>
</div>


{% block script %}

<!-- Customer search and Update -->
<script>
  $(document).ready(function() {

    // Search
    $('.customer-select').select2({
        placeholder: 'Select customer',
        width: "100%",
        ajax: {
            url: '{% url "proposal_app:opportunity:customer-search" %}',
            dataType: 'json',
            delay: 250,
            data: function (params) {
                return {
                    q: params.term
                };
            },
            processResults: function (data) {
                return {
                    results: data.results
                };
            },
            cache: true
        }
    });

    // Update Customer
    $(document).on('change', '.customer-select', function(e) {
      // item code
      var $input = $(e.target);
      var $document_number = $input.data("document");
      // console.log("$document_number", $document_number);

      var value = $input.val();
      // console.log("value",value);

      // Payload data
      data = {
        document_number: $document_number,
        value: value,
      }

      $.ajax({
        url: '{% url "proposal_app:opportunity:customer-search" %}',
        type: 'POST',
        data: data,
        headers: {
          'X-CSRFToken': "{{ csrf_token }}",
        },
        success: function(response) {
          // console.log('Response:', response);
          if (response.code == 200) {
            window.location.reload();
          }
        },
        error: function(xhr, status, error) {
          // console.log("Error:", error);
        }
      });
    });

  });
</script>

<!-- Main Total Js -->
<script>
  $(document).ready(function () {
    let totalSum = 0;

    $(".totals").each(function () {

        const value = $(this).val().replace(/^\$/, '');
        totalSum += parseFloat(value) || 0;
        // console.log("totalSum plus", totalSum);
    });

    // console.log("totalSum", totalSum);

    $(".main_total").val("$"+totalSum.toFixed(2));
  });
</script>

<!-- Update tasks data -->
<script>
  $(".task_code, .task_description, .approve").on("keypress", function(e) {
    if (e.which === 13) {

        e.preventDefault();
        var $input = $(e.target);
        const $id = $(this).data("id");
        const value = $(this).val();
        var inputType = '';

        // console.log("ID", $id);
        // console.log("Value", value);

        if ($input.hasClass("task_code")) {
          inputType = 'task_code';
        } else if ($input.hasClass("task_description")) {
          inputType = 'task_description';
        } else if ($input.hasClass("approve")){
          inputType = 'approve';
        }

        data = {
          "type": inputType,
          "id": $id,
          "value": value,
        }

        $.ajax({
          url: '{% url "proposal_app:opportunity:update-task-mapping-ajax" %}',
          type: 'POST',
          data: data,
          headers: {
            'X-CSRFToken': "{{ csrf_token }}",
          },
          success: function(response) {
            // console.log('Response:', response);
            if (response.status == "success") {
              toastr.success(response.message, 'Updated', {
                closeButton: true,
                progressBar: true,
                positionClass: 'toast-bottom-right',
                timeOut: 6000
              });
            } else {
              toastr.success(response.message, 'Error', {
                closeButton: true,
                progressBar: true,
                positionClass: 'toast-bottom-right',
                timeOut: 6000
              });
            }
          },
          error: function(response) {
            // console.log('Error Response:', response);
            toastr.error(response.message, 'Error', {
              closeButton: true,
              progressBar: true,
              positionClass: 'toast-bottom-right',
              timeOut: 6000
            });
          }
        });
      }
  });
</script>

<!-- Update real time value and Update Assigned Items -->
<script>
  $(".prod_quantity, .prod_cost").on('input', function(e) {
    var $input = $(e.target);
    const $id = $(this).data("id");
    const $task_id = $(this).data("task-id");
    var $row = $(this).closest("tr");
    const value = $input.val().replace(/^\$/, '');
    var $sub_total = 0;

    if ($input.hasClass("prod_quantity")) {
        var $cost = $row.find(".prod_cost").val().replace(/^\$/, '');
        $sub_total = value * $cost;
    } else if ($input.hasClass("prod_cost")) {
        var $quantity = $row.find(".prod_quantity").val().replace(/^\$/, '');
        $sub_total = value * $quantity;
    }

    $row.find(".prod_total").val("$" + $sub_total.toFixed(2));

    let grandTotal = 0;
    $(`.tr-${$task_id}`).each(function() {
        const rowTotal = $(this).find(".prod_total").val().replace(/^\$/, '');
        grandTotal += parseFloat(rowTotal) || 0;
    });

    $(`.task_total_price_${$task_id}`).val("$"+grandTotal.toFixed(2));

    let totalSum = 0;
    $(`.totals`).each(function () {
        const value = $(this).val().replace(/^\$/, '');
        totalSum += parseFloat(value) || 0;
        // console.log("totalSum plus", totalSum);
    });

    $(".main_total").val("$"+totalSum);

  });

  $(".prod_item_code, .prod_labor_task, .prod_description, .prod_local_cost, .prod_quantity, .prod_cost").on('keypress', function(e){

    if (e.which === 13) {
      e.preventDefault();

      var $input = $(e.target);
      const $id = $(this).data("id");
      var $row = $(this).closest("tr");
      const value = $(this).val();
      var inputType = '';

      if ($input.hasClass("prod_item_code")){
        inputType="prod_item_code";
      }else if ($input.hasClass("prod_labor_task")){
        inputType="prod_labor_task";
      }else if ($input.hasClass("prod_local_cost")){
        inputType="prod_local_cost";
      }else if ($input.hasClass("prod_description")){
        inputType="prod_description";
      }else if ($input.hasClass("prod_quantity")){
        inputType="prod_quantity";
      } else if ($input.hasClass("prod_cost")){
        inputType="prod_cost";
      }

      data = {
        "id": $id,
        "value": value,
        "input_type": inputType,
      }

      // ajax request start
      $.ajax({
        url: '{% url "proposal_app:opportunity:update-proposal-item-ajax" %}',
        type: 'POST',
        data: data,
        headers: {
          'X-CSRFToken': "{{ csrf_token }}",
        },
        success: function(response) {
          // console.log('Response:', response);
          if (response.status == "success") {
            toastr.success(response.message, 'Updated', {
              closeButton: true,
              progressBar: true,
              positionClass: 'toast-bottom-right',
              timeOut: 6000
            });
          } else {
            toastr.success(response.message, 'Error', {
              closeButton: true,
              progressBar: true,
              positionClass: 'toast-bottom-right',
              timeOut: 6000
            });
          }
        },
        error: function(response) {
          // console.log('Error Response:', response);
          toastr.error(response.message, 'Error', {
            closeButton: true,
            progressBar: true,
            positionClass: 'toast-bottom-right',
            timeOut: 6000
          });
        }
      });
    }
  });



</script>

<!-- Update Invoice Detils -->
<script>

  $(".invoice_number, .invoice_date, .deposit, .address, .tax_rate, .invoice_sales_tax, .other_tax, .to-address, .buyer, .buyer-date, .buyer-name, .buyer-position, .seller, .seller-date, .seller-name, .seller-position").on("change", function(e){

    id = $(this).data("id");
    var $input = $(e.target);
    var value = "";
    var type = "";

    if ($input.hasClass("invoice_number")){
      value = $(this).val();
      type = "invoice_number";
    }else if ($input.hasClass("invoice_date")){
      value = $(this).val();
      type = "invoice_data";
      $(".invoice_date").val(value);
    }else if ($input.hasClass("deposit")){
      value = $(this).val().replace(/^\$/, '');
      type = "deposit_amount";
    }else if ($input.hasClass("address")){
      value = $(this).val();
      type = "billing_address";
      $(".address").val(value);
    }else if ($input.hasClass("tax_rate")){
      tax_rate = $(this).val();
      value = parseFloat(tax_rate)
      type = "tax_rate";
    }else if ($input.hasClass("invoice_sales_tax")){
      value = $(this).val().replace(/^\$/, '');
      type = "sales_tax";
    }else if ($input.hasClass("other_tax")){
      value = $(this).val().replace(/^\$/, '');
      type = "other_tax";
    }else if ($input.hasClass("to-address")){
      value = $(this).val();
      type = "deposit_address";
    }else if ($input.hasClass("buyer")){
      value = $(this).val();
      type = "buyer";
    }else if ($input.hasClass("buyer-date")){
      value = $(this).val();
      type = "buyer_date";
    }else if ($input.hasClass("buyer-name")){
      value = $(this).val();
      type = "buyer_name";
    }else if ($input.hasClass("buyer-position")){
      value = $(this).val();
      type = "buyer_position";
    }else if ($input.hasClass("seller")){
      value = $(this).val();
      type = "seller";
    }else if ($input.hasClass("seller-date")){
      value = $(this).val();
      type = "seller_date";
    }else if ($input.hasClass("seller-name")){
      value = $(this).val();
      type = "seller_name";
    }else if ($input.hasClass("seller-position")){
      value = $(this).val();
      type = "seller_position";
    }

    // Payload data
    data = {
      "type": type,
      "value": value,
      "id": id,
    }

    // console.log("data", data);

    $.ajax({
      url: '{% url "proposal_app:opportunity:update-invoice-ajax" %}',
      type: 'POST',
      data: data,
      headers: {
        'X-CSRFToken': "{{ csrf_token }}",
      },
      success: function(response) {
        // console.log('API call success:', response);
        if (response.status == "success"){
          toastr.success(response.message, 'Success', {
            closeButton: true,
            progressBar: true,
            positionClass: 'toast-bottom-right',
            timeOut: 6000
          });
        } else{
          toastr.warning(response.message, 'Warning', {
            closeButton: true,
            progressBar: true,
            positionClass: 'toast-bottom-right',
            timeOut: 6000
          });
        }
      },
      error: function(xhr, status, error) {
        console.error('API call error:', status, error);
        toastr.error(xhr.responseJSON.message, 'Error', {
          closeButton: true,
          progressBar: true,
          positionClass: 'toast-bottom-right',
          timeOut: 6000
        });
      }

    });

  });

</script>

<!-- Update Grand Total -->
<script>

  // Get Grand Total
  $(document).ready(function() {

    var main_total = parseFloat($(".main_total").val().replace(/^\$/, '').replace(/,/g, '')) || 0;
    var other_tax = parseFloat($(".other_tax").val().replace(/^\$/, '').replace(/,/g, '')) || 0;
    var tax_rate = parseFloat($(".tax_rate").val()) || 0;
    var sales_tax = parseFloat($(".invoice_sales_tax").val().replace(/^\$/, '').replace(/,/g, '')) || 0;

    var grand_total = main_total + other_tax + sales_tax + (tax_rate / 100);

    $(".grand_total").val("$"+grand_total.toFixed(2));
  });

  // Update Real time value of grand total
  $(".other_tax, .tax_rate, .invoice_sales_tax").on("input", function(e){

    var main_total = parseFloat($(".main_total").val().replace(/^\$/, '').replace(/,/g, '')) || 0;
    var other_tax = parseFloat($(".other_tax").val().replace(/^\$/, '').replace(/,/g, '')) || 0;
    var tax_rate = parseFloat($(".tax_rate").val()) || 0;
    var sales_tax = parseFloat($(".invoice_sales_tax").val().replace(/^\$/, '').replace(/,/g, '')) || 0;

    var grand_total = main_total + other_tax + sales_tax +  (tax_rate / 100);

    $(".grand_total").val("$"+grand_total.toFixed(2));

  });

</script>

<!-- Remove Terms -->
<script>
  $(".remove-terms").on("click", function(e){
    $(this).closest('tr').remove();
  });
</script>

<!-- Save Terms & Condition -->
<script>
  $(document).ready(function() {
    $("a[href='#next']").on('click', function() {

      var foundElements = $(".steps li").find(".current");
      var current_stage_value = $(".current a span.step").text();

      if (current_stage_value == "8"){
        var terms = {
          "term_and_condition": [],
          "pump_installation_terms": [],
          "sales_agreement": []
        };

        $('.tac').each(function() {
          if ($(this).find('input[type="checkbox"]:checked').length > 0) {
            var term_id = $(this).find('.term').data('id');
            var term_value = $(this).find('.term').val();

            if (term_value !== "" && term_value !== null) {
                terms.term_and_condition.push({
                    "id": term_id,
                    "text": term_value
                });
            }
          }
        });

        $('.pit').each(function() {
          if ($(this).find('input[type="checkbox"]:checked').length > 0) {
            var pump_term_id = $(this).find('.pump-term').data('id');
            var pump_term_value = $(this).find('.pump-term').val();

            if (pump_term_value !== "" && pump_term_value !== null) {
                terms.pump_installation_terms.push({
                    "id": pump_term_id,
                    "text": pump_term_value
                });
            }
          }
        });

        $('.spa').each(function() {
          if ($(this).find('input[type="checkbox"]:checked').length > 0) {
            var sales_agreement_id = $(this).find('.sales-agreement').data('id');
            var sales_agreement_value = $(this).find('.sales-agreement').val();
        
            if (sales_agreement_value !== "" && sales_agreement_value !== null) {
                terms.sales_agreement.push({
                    "id": sales_agreement_id,
                    "text": sales_agreement_value
                });
            }        
          }
        });

        var document_number = "{{ opportunity.document_number }}";

        data = {
          "document_number": document_number,
          "type": "term_and_condition",
          "value": JSON.stringify(terms)
        }

        $.ajax({
          url: '{% url "proposal_app:opportunity:update-opportunity-ajax" %}',
          type: 'POST',
          data: data,
          headers: {
            'X-CSRFToken': "{{ csrf_token }}",
          },
          success: function(response) {
            if (response.status == "success"){
              toastr.success(response.message, 'Success', {
                closeButton: true,
                progressBar: true,
                positionClass: 'toast-bottom-right',
                timeOut: 6000
              });
            } else if (response.status == "error"){
              toastr.warning(response.message, 'Warning', {
                closeButton: true,
                progressBar: true,
                positionClass: 'toast-bottom-right',
                timeOut: 6000
              });
            }
          },
          error: function(xhr, status, error) {
            console.error('API call error:', status, error);
            toastr.error(xhr.responseJSON.message, 'Error', {
              closeButton: true,
              progressBar: true,
              positionClass: 'toast-bottom-right',
              timeOut: 6000
            });
          }
        });
      }
    });
  });
</script>

<!-- Add new terms -->
<script>
  $(document).on("keypress", ".new-terms", function(e) {
    if (e.which == 13) {
        e.preventDefault();

        var $currentRow = $(this).closest('tr');

        var $newRow = `
            <tr class="tac">
                <td><input type="checkbox" name=""></td>
                <td>
                    <input type="text" class="form-control term new-terms" placeholder="Write Here" />
                </td>
            </tr>
        `;

        $currentRow.after($newRow);
        $currentRow.next().find('.new-terms').focus();
    }
  });
</script>

<!-- Add new pump term -->
<script>
  $(document).on("keypress", ".new-pump-terms", function(e) {
    if (e.which == 13) {
        e.preventDefault();

        var $currentRow = $(this).closest('tr');

        var $newRow = `
            <tr class="pit">
                <td><input type="checkbox" name=""></td>
                <td>
                    <input type="text" class="form-control pump-term new-pump-terms" placeholder="Write new pump installation term" />
                </td>
            </tr>
        `;

        $currentRow.after($newRow);
        $currentRow.next().find('.new-pump-terms').focus();
    }
  });

</script>

<!-- Add sales term -->
<script>
  $(document).on("keypress", ".new-sales-agreement", function(e) {
    if (e.which == 13) {
        e.preventDefault();
        // console.log("New Pump terms added");
        var $currentRow = $(this).closest('tr');
        var $newRow = `
            <tr class="spa">
                <td><input type="checkbox" name=""></td>
                <td>
                    <input type="text" class="form-control sales-agreement new-sales-agreement" placeholder="Write new sales and approval agreement..." />
                </td>
            </tr>
        `;

        $currentRow.after($newRow);
        $currentRow.next().find('.new-sales-agreement').focus();
    }
  });
</script>

{% endblock script %}