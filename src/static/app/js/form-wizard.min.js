$(document).ready(function () {
    // Initialize the first step wizard
    $(".icons-tab-steps").steps({
        headerTag: "h6",
        bodyTag: "fieldset",
        transitionEffect: "fade",
        titleTemplate: '<span class="step">#index#</span> #title#',
        labels: { finish: "Submit" },
        onStepChanging: function (event, currentIndex, newIndex) {
            // Validate only when moving forward
            if (newIndex > currentIndex) {
                var isValid = true;
                var currentFieldset = $(this).find("fieldset").eq(currentIndex);

                // Validate fields on the current step
                currentFieldset.find('.wizard-required').each(function () {
                    var thisValue = $(this).val();
                    var errorMessage = "";

                    // For select elements, check if the value is empty or the placeholder
                    if ($(this).is('select')) {
                        if (thisValue === "" || $(this).find('option:selected').text() === "None") {
                            errorMessage = "Please select a status.";
                        }
                    } else {
                        // Handle other types of inputs
                        if (thisValue === "") {
                            errorMessage = "Please fill required fields...";
                        }
                    }

                    if (errorMessage) {
                        $(this).siblings(".wizard-form-error").text(errorMessage).slideDown();
                        isValid = false;

                        // Display error message via SweetAlert2
                        Swal.fire({
                            text: errorMessage,
                            icon: 'error',
                            confirmButtonText: 'OK'
                        });
                        return false; // Stop further validation for this step
                    } else {
                        $(this).siblings(".wizard-form-error").slideUp();
                    }
                });

                return isValid; // Prevent navigation to the next step if validation fails
            }

            // Allow backward navigation
            return true;
        },
        onFinished: function (event, currentIndex) {
            var isValid = true;
            var currentFieldset = $(this).find("fieldset").eq(currentIndex);

            // Final validation on form submit
            currentFieldset.find('.wizard-required').each(function () {
                var thisValue = $(this).val();
                var errorMessage = "";

                // For select elements, check if the value is empty or the placeholder
                if ($(this).is('select')) {
                    if (thisValue === "" || $(this).find('option:selected').text() === "None") {
                        errorMessage = "Please select a valid option.";
                    }
                } else {
                    // Handle other types of inputs
                    if (thisValue === "") {
                        errorMessage = "This field is required.";
                    }
                }

                if (errorMessage) {
                    $(this).siblings(".wizard-form-error").text(errorMessage).slideDown();
                    isValid = false;

                    // Display error message via SweetAlert2
                    Swal.fire({
                        text: errorMessage,
                        icon: 'error',
                        confirmButtonText: 'OK'
                    });
                    return false; // Stop further validation for this step
                } else {
                    $(this).siblings(".wizard-form-error").slideUp();
                }
            });

            if (isValid) {
                Swal.fire({
                    title: 'Form Submitted!',
                    text: 'Your form has been submitted successfully.',
                    icon: 'success',
                    confirmButtonText: 'OK'
                });
            }
        }
    });

    // Initialize the secondary step wizard
    $(".icons-tab-steps-sub").steps({
        headerTag: "h1",
        bodyTag: "div",
        transitionEffect: "fade",
        titleTemplate: '<span class="step">#key#</span> #value#',
        stepsOrientation: 0,
        onStepChanging: function (event, currentIndex, newIndex) {
            // Validate only when moving forward
            if (newIndex > currentIndex) {
                var isValid = true;
                var currentDiv = $(this).find("div").eq(currentIndex);

                // Validate fields on the current step
                currentDiv.find('.wizard-required').each(function () {
                    var thisValue = $(this).val();
                    var errorMessage = "";

                    // For select elements, check if the value is empty or the placeholder
                    if ($(this).is('select')) {
                        if (thisValue === "" || $(this).find('option:selected').text() === "None") {
                            errorMessage = "Please select a valid option.";
                        }
                    } else {
                        // Handle other types of inputs
                        if (thisValue === "") {
                            errorMessage = "This field is required.";
                        }
                    }

                    if (errorMessage) {
                        $(this).siblings(".wizard-form-error").text(errorMessage).slideDown();
                        isValid = false;

                        // Display error message via SweetAlert2
                        Swal.fire({
                            title: 'Validation Error',
                            text: errorMessage,
                            icon: 'error',
                            confirmButtonText: 'OK'
                        });
                        return false; // Stop further validation for this step
                    } else {
                        $(this).siblings(".wizard-form-error").slideUp();
                    }
                });

                return isValid; // Prevent navigation to the next step if validation fails
            }

            // Allow backward navigation
            return true;
        },
        onFinished: function (event, currentIndex) {
            var isValid = true;
            var currentDiv = $(this).find("div").eq(currentIndex);

            // Final validation on form submit
            currentDiv.find('.wizard-required').each(function () {
                var thisValue = $(this).val();
                var errorMessage = "";

                // For select elements, check if the value is empty or the placeholder
                if ($(this).is('select')) {
                    if (thisValue === "" || $(this).find('option:selected').text() === "None") {
                        errorMessage = "Please select a valid option.";
                    }
                } else {
                    // Handle other types of inputs
                    if (thisValue === "") {
                        errorMessage = "This field is required.";
                    }
                }

                if (errorMessage) {
                    $(this).siblings(".wizard-form-error").text(errorMessage).slideDown();
                    isValid = false;

                    // Display error message via SweetAlert2
                    Swal.fire({
                        title: 'Validation Error',
                        text: errorMessage,
                        icon: 'error',
                        confirmButtonText: 'OK'
                    });
                    return false; // Stop further validation for this step
                } else {
                    $(this).siblings(".wizard-form-error").slideUp();
                }
            });

            if (isValid) {
                Swal.fire({
                    title: 'Form Submitted!',
                    text: 'Your form has been submitted successfully.',
                    icon: 'success',
                    confirmButtonText: 'OK'
                });
            }
        }
    });

    // Initialize date picker
    $(".pickadate").pickadate();

    // Add custom classes to navigation buttons
    $('.wizard .actions a[role="menuitem"]').addClass("btn btn-primary");
    $('.wizard .actions a[href="#previous"]').addClass("btn btn-secondary");
});
