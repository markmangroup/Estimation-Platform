$(document).ready(function () {
    // Initialize the first step wizard
    $(".icons-tab-steps").steps({
        headerTag: "h6",
        bodyTag: "fieldset",
        transitionEffect: "fade",
        titleTemplate: '<span class="step">#index#</span> #title#',
        labels: { finish: "Submit" },
        onStepChanging: function (event, currentIndex, newIndex) {
            if (newIndex > currentIndex) {
                var isValid = true;
                var currentFieldset = $(this).find("fieldset").eq(currentIndex);

                currentFieldset.find('.wizard-required').each(function () {
                    var thisValue = $(this).val();
                    var errorMessage = "";
                    var dataValue = $(this).data('value');

                    if ($(this).is('select')) {
                        if (thisValue === "" || $(this).find('option:selected').text() === "None") {
                            errorMessage = "Please make sure to update or change statuses as needed and verify them.";
                        }
                    } else if ($(this).is('input')){
                        var inputType = $(this).attr('type');

                        if (inputType === 'text') {
                            if (thisValue === "") {
                                errorMessage = "Could you please confirm that the quantity was filled correctly?";
                            } else if (thisValue != dataValue) {
                                errorMessage = `Quantity does not match for PROJ016968 1/2. Please resolve it....`;
                            }
                        } else if (inputType === 'date') {
                            if (thisValue === "") {
                                errorMessage = "Make sure update date, please verify and update the dates...";
                            } else if (new Date(thisValue) < new Date() && new Date(thisValue).toDateString() !== new Date().toDateString()) {
                                errorMessage = "Please make sure that the date selected is a current or future date and not a date that has already passed.";
                            }
                        }
                    }else {
                        if (thisValue === "") {
                            errorMessage = "Could you please confirm that the quantity was filled correctly?";
                        }
                    }

                    if (errorMessage) {
                        $(this).siblings(".wizard-form-error").text(errorMessage).slideDown();
                        isValid = false;

                        Swal.fire({
                            text: errorMessage,
                            icon: 'error',
                            confirmButtonText: 'OK'
                        });
                        return false; // Stop further validation for this step
                    } else {
                        $(this).siblings(".wizard-form-error").slideUp();
                    }
                });

                return isValid;
            }

            return true;
        },
        onFinished: function (event, currentIndex) {
            var isValid = true;
            var currentFieldset = $(this).find("fieldset").eq(currentIndex);

            currentFieldset.find('.wizard-required').each(function () {
                var thisValue = $(this).val();
                var isDisabled = $("#field-disabled").prop('disabled');
                var errorMessage = "";
                var dataValue = $(this).data('value');

                if ($(this).is('select')) {
                    if (thisValue === "" || $(this).find('option:selected').text() === "None") {
                        errorMessage = "Please make sure to update or change statuses as needed and verify them.";
                    }
                }else if(!isDisabled){
                    console.log("Not Disabled...........");
                    errorMessage = "Here are some inspection still not confirm, please make sure all inspection are confirmed...";
                }else if ($(this).is('input')){
                    var inputType = $(this).attr('type');

                    if (inputType === 'text') {
                        if (thisValue === "") {
                            errorMessage = "Could you please confirm that the quantity was filled correctly?";
                        } else if (thisValue != dataValue) {
                            errorMessage = `Quantity does not match for PROJ016968 1/2. Please resolve it....`;
                        }
                    } else if (inputType === 'date') {
                        if (thisValue === "") {
                            errorMessage = "Make sure update date, please verify and update the dates...";
                        } else if (new Date(thisValue) < new Date() && new Date(thisValue).toDateString() !== new Date().toDateString()) {
                            errorMessage = "Please make sure that the date selected is a current or future date and not a date that has already passed.";
                        }
                    }
                }
                else {
                    if (thisValue === "") {
                        errorMessage = "Could you please confirm that the quantity was filled correctly?";
                    }
                }

                if (errorMessage) {
                    $(this).siblings(".wizard-form-error").text(errorMessage).slideDown();
                    isValid = false;

                    Swal.fire({
                        text: errorMessage,
                        icon: 'error',
                        confirmButtonText: 'OK'
                    });
                    return false; // Stop further validation for this step
                } else {
                    $(this).siblings(".wizard-form-error").slideUp();
                }
            });

            if (isValid) {
                Swal.fire({
                    title: 'Form Submitted!',
                    text: 'Your form has been submitted successfully.',
                    icon: 'success',
                    confirmButtonText: 'OK'
                });
            }
        }
    });

    // Initialize date picker
    $(".pickadate").pickadate();

    // Add custom classes to navigation buttons
    $('.wizard .actions a[role="menuitem"]').addClass("btn btn-primary");
    $('.wizard .actions a[href="#previous"]').addClass("btn btn-secondary");
});
